(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{606:function(e,t,s){e.exports=s.p+"assets/img/message_processing.2476db9f.png"},607:function(e,t,s){e.exports=s.p+"assets/img/keeper.46a11cf4.png"},728:function(e,t,s){"use strict";s.r(t);var o=s(1),a=Object(o.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"modules"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#modules"}},[e._v("#")]),e._v(" Modules")]),e._v(" "),o("HighlightBox",{attrs:{type:"synopsis"}},[o("p",[e._v("This section tackles modules. Taking a look at the following sections is recommended to better understand modules in the Cosmos SDK:")]),e._v(" "),o("ul",[o("li",[o("RouterLink",{attrs:{to:"/academy/2-main-concepts/transactions.html"}},[e._v("Transactions")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/academy/2-main-concepts/messages.html"}},[e._v("Messages")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/academy/2-main-concepts/queries.html"}},[e._v("Queries")])],1)]),e._v(" "),o("p",[e._v("You can find a code example illustrating module creation and introduction for your checkers blockchain at the end of this section.")])]),e._v(" "),o("p",[e._v("Each Cosmos chain is a purpose-built blockchain. Cosmos SDK modules define the unique properties of each chain. Modules can be considered state machines within the larger state machine. They contain the storage layout or state and the state transition functions, which are the message methods.")]),e._v(" "),o("p",[e._v("Modules define most of the logic of Cosmos SDK applications.")]),e._v(" "),o("p",[o("img",{attrs:{src:s(606),alt:"Transaction message flow to modules"}})]),e._v(" "),o("p",[e._v("When a transaction is relayed from the underlying Tendermint consensus engine, "),o("code",[e._v("BaseApp")]),e._v(" decomposes the "),o("code",[e._v("Messages")]),e._v(" contained within the transaction. "),o("code",[e._v("BaseApp")]),e._v(" routes messages to the appropriate module for processing. Interpretation and execution occur when the appropriate module message handler receives the message.")]),e._v(" "),o("p",[e._v("Developers compose together modules using the Cosmos SDK to build custom application-specific blockchains.")]),e._v(" "),o("h2",{attrs:{id:"module-scope"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#module-scope"}},[e._v("#")]),e._v(" Module scope")]),e._v(" "),o("p",[e._v("Modules include "),o("strong",[e._v("core")]),e._v(" functionality that every blockchain node needs:")]),e._v(" "),o("ul",[o("li",[e._v("A boilerplate implementation of the Application Blockchain Interface (ABCI) that communicates with the underlying Tendermint consensus engine.")]),e._v(" "),o("li",[e._v("A general-purpose data store that persists the module state called "),o("code",[e._v("multistore")]),e._v(".")]),e._v(" "),o("li",[e._v("A server and interfaces to facilitate interactions with the node.")])]),e._v(" "),o("p",[e._v("Modules implement the majority of the application logic while the "),o("strong",[e._v("core")]),e._v(" attends to wiring and infrastructure concerns and enables modules to be composed into higher-order modules.")]),e._v(" "),o("p",[e._v("A module defines a subset of the overall state using:")]),e._v(" "),o("ul",[o("li",[e._v("One or more keys/value stores known as "),o("code",[e._v("KVStore")])]),e._v(" "),o("li",[e._v("A subset of message types that are needed by the application and do not exist yet.")])]),e._v(" "),o("p",[e._v("Modules also define interactions with other modules that do already exist.")]),e._v(" "),o("p",[e._v("Most of the work For developers involved in building a Cosmos SDK application revolves around building custom modules required by their application that do not exist yet and integrating them with modules that already exist into one coherent application. Existing modules can come either from the Cosmos SDK itself or from "),o("strong",[e._v("third-party developers")]),e._v(". You can download them from an online module repository.")]),e._v(" "),o("h2",{attrs:{id:"module-components"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#module-components"}},[e._v("#")]),e._v(" Module components")]),e._v(" "),o("p",[e._v("It is a best practice to define a module in the "),o("code",[e._v("x/moduleName")]),e._v(" folder. For example, the module called "),o("code",[e._v("Checkers")]),e._v(" would go in "),o("code",[e._v("x/checkers")]),e._v(". If you head over to the Cosmos SDK's base code, you can see that it also "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/tree/master/x",target:"_blank",rel:"noopener noreferrer"}},[e._v("defines its modules"),o("OutboundLink")],1),e._v(" in an "),o("code",[e._v("x/")]),e._v(" folder.")]),e._v(" "),o("p",[e._v("Modules implement several elements:")]),e._v(" "),o("Accordion",{attrs:{items:[{title:"Interfaces",description:"Interfaces facilitate communication between modules and the composition of multiple modules into coherent applications."},{title:"Protobuf",description:"Protobuf is one `Msg` service to handle messages and one gRPC `Query` service to handle queries"},{title:"Keeper",description:"A Keeper is a controller that defines the state and presents methods for updating and inspecting the state."}]}}),e._v(" "),o("h3",{attrs:{id:"interfaces"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#interfaces"}},[e._v("#")]),e._v(" Interfaces")]),e._v(" "),o("p",[e._v("A module must implement "),o("strong",[e._v("three application module interfaces")]),e._v(" to be integrated with the rest of the application:")]),e._v(" "),o("ul",[o("li",[o("strong",[o("code",[e._v("AppModuleBasic")]),e._v(":")]),e._v(" implements non-dependent elements of the module.")]),e._v(" "),o("li",[o("strong",[o("code",[e._v("AppModule")]),e._v(":")]),e._v(" interdependent, specialized elements of the module that are unique to the application.")]),e._v(" "),o("li",[o("strong",[o("code",[e._v("AppModuleGenesis")]),e._v(":")]),e._v(" interdependent, genesis/initialization elements of the module that establish the initial state of the blockchain at inception.")])]),e._v(" "),o("p",[e._v("You define "),o("code",[e._v("AppModule")]),e._v(" and "),o("code",[e._v("AppModuleBasic")]),e._v(", and their functions in your module's "),o("code",[e._v("x/moduleName/module.go")]),e._v(" file.")]),e._v(" "),o("h3",{attrs:{id:"protobuf-services"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#protobuf-services"}},[e._v("#")]),e._v(" Protobuf services")]),e._v(" "),o("p",[e._v("Each module defines two Protobuf services:")]),e._v(" "),o("ul",[o("li",[o("strong",[o("code",[e._v("Msg")]),e._v(":")]),e._v(" a set of RPC methods related one-to-one to Protobuf request types to handle messages.")]),e._v(" "),o("li",[o("strong",[o("code",[e._v("Query")]),e._v(":")]),e._v(" gRPC query service to handle queries.")])]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("If the topic is new to you, check out an introduction to "),o("a",{attrs:{href:"https://www.ionos.com/digitalguide/websites/web-development/protocol-buffers-explained/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Protocol Buffers"),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("h3",{attrs:{id:"msg-service"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#msg-service"}},[e._v("#")]),e._v(" "),o("code",[e._v("Msg")]),e._v(" service")]),e._v(" "),o("p",[e._v("Regarding the "),o("code",[e._v("Msg")]),e._v(" service keep in mind:")]),e._v(" "),o("ul",[o("li",[e._v("A best practice is to define the "),o("code",[e._v("Msg")]),e._v(" Protobuf service in the "),o("code",[e._v("tx.proto")]),e._v(" file.")]),e._v(" "),o("li",[e._v("Each module should implement the "),o("code",[e._v("RegisterServices")]),e._v(" method as part of the "),o("code",[e._v("AppModule")]),e._v(" interface. This lets the application know which messages and queries the module can handle.")]),e._v(" "),o("li",[e._v("Service methods should use a "),o("em",[e._v("keeper")]),e._v(", which encapsulates knowledge about the storage layout and presents methods for updating the state.")])]),e._v(" "),o("h3",{attrs:{id:"grpc-query-service"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#grpc-query-service"}},[e._v("#")]),e._v(" gRPC "),o("code",[e._v("Query")]),e._v(" service")]),e._v(" "),o("p",[e._v("For the gRPC "),o("code",[e._v("Query")]),e._v(" service keep in mind:")]),e._v(" "),o("ul",[o("li",[e._v("A best practice is to define the "),o("code",[e._v("Query")]),e._v(" Protobuf service in the "),o("code",[e._v("query.proto")]),e._v(" file.")]),e._v(" "),o("li",[e._v("Allows users to query the state using gRPC.")]),e._v(" "),o("li",[e._v("Each gRPC endpoint corresponds to a service method, named with the "),o("code",[e._v("rpc")]),e._v(" prefix inside the gRPC "),o("code",[e._v("Query")]),e._v(" service.")]),e._v(" "),o("li",[e._v("Can be configured under the "),o("code",[e._v("grpc.enable")]),e._v(" and "),o("code",[e._v("grpc.address")]),e._v(" fields in "),o("code",[e._v("app.toml")]),e._v(".")])]),e._v(" "),o("p",[e._v("Protobuf generates a "),o("code",[e._v("QueryServer")]),e._v(" interface containing all the service methods for each module. Modules implement this "),o("code",[e._v("QueryServer")]),e._v(" interface by providing the concrete implementation of each service method in separate files. These implementation methods are the handlers of the corresponding gRPC query endpoints. This division of concerns across different files makes the setup safe from a re-generation of files by Protobuf.")]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[o("a",{attrs:{href:"https://grpc.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("gRPC"),o("OutboundLink")],1),e._v(" is a modern, open-source, high-performance framework that supports multiple languages. It is the recommended standard for external clients such as wallets, browsers, and backend services to interact with a node.")])]),e._v(" "),o("p",[e._v("gRPC-Gateway REST endpoints support external clients that may not wish to use gRPC. The Cosmos SDK provides a gRPC-gateway REST endpoint for each gRPC service.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("Have a look at the "),o("a",{attrs:{href:"https://grpc-ecosystem.github.io/grpc-gateway/",target:"_blank",rel:"noopener noreferrer"}},[e._v("gRPC-Gateway documentation"),o("OutboundLink")],1),e._v(" on more on the gRPC-Gateway plugin.")])]),e._v(" "),o("h3",{attrs:{id:"command-line-commands"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#command-line-commands"}},[e._v("#")]),e._v(" Command-line commands")]),e._v(" "),o("p",[e._v("Each module defines commands for a command-line interface (CLI). Commands related to a module are defined in a folder called "),o("code",[e._v("client/cli")]),e._v(". The CLI divides commands into two categories: transactions and queries. These are the same as those which you defined in "),o("code",[e._v("tx.go")]),e._v(" and "),o("code",[e._v("query.go")]),e._v(" respectively.")]),e._v(" "),o("h3",{attrs:{id:"keeper"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#keeper"}},[e._v("#")]),e._v(" Keeper")]),e._v(" "),o("p",[e._v("Keepers are the gatekeepers to the module’s store(s). It is mandatory to go through a module’s keeper to access the store(s). A keeper encapsulates the knowledge about the layout of the storage within the store and contains methods to update and inspect it. If you come from a module-view-controller (MVC) world, then it helps to think of the keeper as the controller.")]),e._v(" "),o("p",[o("img",{attrs:{src:s(607),alt:"Keeper in a node"}})]),e._v(" "),o("p",[e._v("Other modules may need access to a store, but other modules are also potentially malicious or poorly written. For this reason, developers need to consider who/what should have access to their module store(s). To prevent a module from randomly accessing another module at runtime, a module that needs access to another module needs to declare its intent to use another module at construction. At this point, such a module is granted a runtime key that lets it access the other module. Only modules that hold this key to a store can access the store. This is part of what is called an object-capability model.")]),e._v(" "),o("p",[e._v("Keepers are defined in "),o("code",[e._v("keeper.go")]),e._v(". A keeper's type definition generally consists of keys to the module's own store in the "),o("code",[e._v("multistore")]),e._v(", references to other modules' keepers, and a reference to the application's codec.")]),e._v(" "),o("h2",{attrs:{id:"core-modules"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#core-modules"}},[e._v("#")]),e._v(" Core modules")]),e._v(" "),o("p",[e._v("The Cosmos SDK includes a set of core modules that address common concerns with well-solved, standardized implementations. Core modules address application needs such as tokens, staking, and governance.")]),e._v(" "),o("p",[e._v("Core modules offer several advantages over ad-hoc solutions:")]),e._v(" "),o("ul",[o("li",[e._v("Standardization is established early, which helps ensure good interoperability with wallets, analytics, other modules, and other Cosmos SDK applications.")]),e._v(" "),o("li",[e._v("Duplication of effort is significantly reduced because application developers focus on what is unique about their application.")]),e._v(" "),o("li",[e._v("Core modules are working examples of Cosmos SDK modules that provide strong hints about suggested structure, style, and best practices.")])]),e._v(" "),o("p",[e._v("Developers create coherent applications by selecting and composing core modules first and then implementing the custom logic.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("Why not explore the "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/tree/master/x",target:"_blank",rel:"noopener noreferrer"}},[e._v("list of core modules and the application concerns they address"),o("OutboundLink")],1),e._v("?")])]),e._v(" "),o("h2",{attrs:{id:"design-principles-when-building-modules"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#design-principles-when-building-modules"}},[e._v("#")]),e._v(" Design principles when building modules")]),e._v(" "),o("p",[e._v("The following design principles are of importance when building modules:")]),e._v(" "),o("Accordion",{attrs:{items:[{title:"Interfaces",description:"Interfaces facilitate communication between modules and the composition of multiple modules into coherent applications."},{title:"Protobuf",description:"Protobuf is one `Msg` service to handle messages and one gRPC `Query` service to handle queries"},{title:"Keeper",description:"A Keeper is a controller that defines the state and presents methods for updating and inspecting the state."}]}}),e._v(" "),o("h2",{attrs:{id:"recommended-folder-structure"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#recommended-folder-structure"}},[e._v("#")]),e._v(" Recommended folder structure")]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("These ideas are meant to be applied as suggestions. Application developers are encouraged to improve and contribute to the module structure and development design.")])]),e._v(" "),o("h3",{attrs:{id:"structure"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#structure"}},[e._v("#")]),e._v(" Structure")]),e._v(" "),o("p",[e._v("A typical Cosmos SDK module can be structured as follows:")]),e._v(" "),o("ol",[o("li",[e._v("The serializable data types and Protobuf interfaces:")])]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[e._v("proto\n└── "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("project_name"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    └── "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module_name"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n        └── "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("proto_version"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n            ├── "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module_name"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(".proto\n            ├── event.proto\n            ├── genesis.proto\n            ├── query.proto\n            └── tx.proto\n")])])]),o("ul",[o("li",[o("code",[e._v("{module_name}.proto")]),e._v(": the module's common message type definitions.")]),e._v(" "),o("li",[o("code",[e._v("event.proto")]),e._v(": the module's message type definitions related to events.")]),e._v(" "),o("li",[o("code",[e._v("genesis.proto")]),e._v(": the module's message type definitions related to the genesis state.")]),e._v(" "),o("li",[o("code",[e._v("query.proto")]),e._v(": the module's "),o("code",[e._v("Query")]),e._v(" service and related message type definitions.")]),e._v(" "),o("li",[o("code",[e._v("tx.proto")]),e._v(": the module's "),o("code",[e._v("Msg")]),e._v(" service and related message type definitions.")])]),e._v(" "),o("ol",{attrs:{start:"2"}},[o("li",[e._v("Then the rest of the code elements:")])]),e._v(" "),o("div",{staticClass:"language-shell extra-class"},[o("pre",{pre:!0,attrs:{class:"language-shell"}},[o("code",[e._v("x/"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module_name"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n├── client\n│   ├── cli\n│   │   ├── query.go\n│   │   └── tx.go\n│   └── testutil\n│       ├── cli_test.go\n│       └── suite.go\n├── exported\n│   └── exported.go\n├── keeper\n│   ├── genesis.go\n│   ├── grpc_query.go\n│   ├── hooks.go\n│   ├── invariants.go\n│   ├── keeper.go\n│   ├── keys.go\n│   ├── msg_server.go\n│   └── querier.go\n├── module\n│   └── module.go\n├── simulation\n│   ├── decoder.go\n│   ├── genesis.go\n│   ├── operations.go\n│   └── params.go\n├── spec\n│   ├── 01_concepts.md\n│   ├── 02_state.md\n│   ├── 03_messages.md\n│   └── 04_events.md\n├── "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module_name"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(".pb.go\n├── abci.go\n├── codec.go\n├── errors.go\n├── events.go\n├── events.pb.go\n├── expected_keepers.go\n├── genesis.go\n├── genesis.pb.go\n├── keys.go\n├── msgs.go\n├── params.go\n├── query.pb.go\n└── tx.pb.go\n")])])]),o("ul",[o("li",[o("code",[e._v("client/")]),e._v(": the module's CLI client functionality implementation and the module's integration testing suite.")]),e._v(" "),o("li",[o("code",[e._v("exported/")]),e._v(": the module's exported types - typically interface types. If a module relies on keepers from another module, it is expected to receive the keepers as interface contracts through the "),o("code",[e._v("expected_keepers.go")]),e._v(" file (see below) to avoid a direct dependency on the module implementing the keepers. However, these interface contracts can define methods that operate on and/or return types that are specific to the module that is implementing the keepers. This is where "),o("code",[e._v("exported/")]),e._v(" comes into play. The interface types that are defined in "),o("code",[e._v("exported/")]),e._v(" use canonical types that allow for the module to receive the keepers as interface contracts through the "),o("code",[e._v("expected_keepers.go")]),e._v(" file. This pattern allows for code to remain "),o("a",{attrs:{href:"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself",target:"_blank",rel:"noopener noreferrer"}},[e._v("DRY"),o("OutboundLink")],1),e._v(" and also alleviates import cycle chaos.")]),e._v(" "),o("li",[o("code",[e._v("keeper/")]),e._v(": the module's "),o("code",[e._v("Keeper")]),e._v(" and "),o("code",[e._v("MsgServer")]),e._v(" implementations.")]),e._v(" "),o("li",[o("code",[e._v("module/")]),e._v(": the module's "),o("code",[e._v("AppModule")]),e._v(" and "),o("code",[e._v("AppModuleBasic")]),e._v(" implementations.")]),e._v(" "),o("li",[o("code",[e._v("simulation/")]),e._v(": the module's simulation package defines functions used by the blockchain simulator application ("),o("code",[e._v("simapp")]),e._v(").")]),e._v(" "),o("li",[o("code",[e._v("spec/")]),e._v(": the module's specification documents outlining important concepts, state storage structure, and message and event type definitions.")]),e._v(" "),o("li",[e._v("The root directory includes type definitions for messages, events, and genesis state including the type definitions generated by Protocol Buffers.\n"),o("ul",[o("li",[o("code",[e._v("abci.go")]),e._v(": the module's "),o("code",[e._v("BeginBlocker")]),e._v(" and "),o("code",[e._v("EndBlocker")]),e._v(" implementations. This file is only required if "),o("code",[e._v("BeginBlocker")]),e._v(" and/or "),o("code",[e._v("EndBlocker")]),e._v(" need to be defined.")]),e._v(" "),o("li",[o("code",[e._v("codec.go")]),e._v(": the module's registry methods for interface types.")]),e._v(" "),o("li",[o("code",[e._v("errors.go")]),e._v(": the module's sentinel errors.")]),e._v(" "),o("li",[o("code",[e._v("events.go")]),e._v(": the module's event types and constructors.")]),e._v(" "),o("li",[o("code",[e._v("expected_keepers.go")]),e._v(": the module's expected other keeper interfaces.")]),e._v(" "),o("li",[o("code",[e._v("genesis.go")]),e._v(": the module's genesis state methods and helper functions.")]),e._v(" "),o("li",[o("code",[e._v("keys.go")]),e._v(": the module's store keys and associated helper functions.")]),e._v(" "),o("li",[o("code",[e._v("msgs.go")]),e._v(": the module's message type definitions and associated methods.")]),e._v(" "),o("li",[o("code",[e._v("params.go")]),e._v(": the module's parameter type definitions and associated methods.")]),e._v(" "),o("li",[o("code",[e._v("*.pb.go")]),e._v(": the module's type definitions generated by Protocol Buffers as defined in the respective "),o("code",[e._v("*.proto")]),e._v(" files above.")])])])]),e._v(" "),o("h2",{attrs:{id:"errors"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#errors"}},[e._v("#")]),e._v(" Errors")]),e._v(" "),o("p",[e._v("Modules are encouraged to define and register their own errors to provide better context on failed message or handler execution. Errors should be common or general errors, which can be further wrapped to provide additional specific execution context.")]),e._v(" "),o("HighlightBox",{attrs:{type:"tip"}},[o("p",[e._v("For more details take a look at the "),o("a",{attrs:{href:"https://docs.cosmos.network/master/building-modules/errors.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Cosmos SDK documentation on errors when building modules"),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("h3",{attrs:{id:"registration"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#registration"}},[e._v("#")]),e._v(" Registration")]),e._v(" "),o("p",[e._v("Modules should define and register their custom errors in "),o("code",[e._v("x/{module}/errors.go")]),e._v(". Registration of errors is handled via the "),o("code",[e._v("types/errors")]),e._v(" package.")]),e._v(" "),o("p",[e._v('Each custom module error must provide the codespace, which is typically the module name (for example, "distribution") and is unique per module, and a '),o("code",[e._v("uint32")]),e._v(" code. The codespace and code together provide a globally unique Cosmos SDK error.")]),e._v(" "),o("p",[e._v("The only restrictions on error codes are the following:")]),e._v(" "),o("ul",[o("li",[e._v("It must be greater than one, as a code value of one is reserved for internal errors.")]),e._v(" "),o("li",[e._v("It must be unique within the module.")])]),e._v(" "),o("HighlightBox",{attrs:{type:"info"}},[o("p",[e._v("The Cosmos SDK provides a core set of common errors. These errors are defined in "),o("a",{attrs:{href:"https://github.com/cosmos/cosmos-sdk/blob/master/types/errors/errors.go",target:"_blank",rel:"noopener noreferrer"}},[o("code",[e._v("types/errors/errors.go")]),o("OutboundLink")],1),e._v(".")])]),e._v(" "),o("h3",{attrs:{id:"wrapping"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#wrapping"}},[e._v("#")]),e._v(" Wrapping")]),e._v(" "),o("p",[e._v("The custom module errors can be returned as their concrete type, as they already fulfill the error interface. Module errors can be wrapped to provide further context and meaning to failed execution.")]),e._v(" "),o("p",[e._v("Regardless of whether an error is wrapped or not, the Cosmos SDK's errors package provides an API to determine if an error is of a particular kind via "),o("code",[e._v("Is")]),e._v(".")]),e._v(" "),o("h3",{attrs:{id:"abci"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#abci"}},[e._v("#")]),e._v(" ABCI")]),e._v(" "),o("p",[e._v("If a module error is registered, the Cosmos SDK errors package allows ABCI information to be extracted through the "),o("code",[e._v("ABCIInfo")]),e._v(" API. The package also provides "),o("code",[e._v("ResponseCheckTx")]),e._v(" and "),o("code",[e._v("ResponseDeliverTx")]),e._v(" as auxiliary APIs to automatically get "),o("code",[e._v("CheckTx")]),e._v(" and "),o("code",[e._v("DeliverTx")]),e._v(" responses from an error.")]),e._v(" "),o("h2",{attrs:{id:"next-up"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[e._v("#")]),e._v(" Next up")]),e._v(" "),o("p",[e._v("Have a look at the code example below or head straight to the "),o("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[e._v("next section")]),e._v(" for an introduction to Protobuf.")],1),e._v(" "),o("ExpansionPanel",{attrs:{title:"Show me some code for my checkers blockchain"}},[o("p",[e._v("Now your application is starting to take shape.")]),e._v(" "),o("h2",{attrs:{id:"the-checkers-module"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#the-checkers-module"}},[e._v("#")]),e._v(" The "),o("code",[e._v("checkers")]),e._v(" module")]),e._v(" "),o("p",[e._v("When you create your checkers blockchain application, you ought to include a majority of the standard modules like "),o("code",[e._v("auth")]),e._v(", "),o("code",[e._v("bank")]),e._v(", and so on. With the Cosmos SDK boilerplate in place, the "),o("em",[e._v("checkers part")]),e._v(" of your checkers application will most likely reside in a single "),o("code",[e._v("checkers")]),e._v(" module. This is the module that you author.")]),e._v(" "),o("h2",{attrs:{id:"game-wager"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#game-wager"}},[e._v("#")]),e._v(" Game wager")]),e._v(" "),o("p",[e._v("Earlier the goal was to let players play with "),o("em",[e._v("money")]),e._v(". With the introduction of modules like "),o("code",[e._v("bank")]),e._v(" you can start handling that.")]),e._v(" "),o("p",[e._v("The initial ideas are:")]),e._v(" "),o("ul",[o("li",[e._v("The wager amount is declared when creating a game.")]),e._v(" "),o("li",[e._v('Each player is billed the amount when doing their first move, which is interpreted as "challenge accepted". The amount should not be deducted on the game creation. If the opponent rejects the game or the game times out, the first player gets refunded.')]),e._v(" "),o("li",[e._v("Subsequent moves by a player do not cost anything.")]),e._v(" "),o("li",[e._v("If a game ends in a win or times out on a forfeit, the winning player gets the total wager amount.")]),e._v(" "),o("li",[e._v("If a game ends in a draw, then both players get back their amount.")])]),e._v(" "),o("p",[e._v("How would this look like in terms of code? You need to add the wager to:")]),e._v(" "),o("ul",[o("li",[o("p",[e._v("The game:")]),e._v(" "),o("div",{staticClass:"language-go extra-class"},[o("pre",{pre:!0,attrs:{class:"language-go"}},[o("code",[o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" StoredGame "),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n    Wager "),o("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint64")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])]),e._v(" "),o("li",[o("p",[e._v("The message to create a game:")]),e._v(" "),o("div",{staticClass:"language-go extra-class"},[o("pre",{pre:!0,attrs:{class:"language-go"}},[o("code",[o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" MsgCreateGame "),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n    Wager "),o("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint64")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])])]),e._v(" "),o("h2",{attrs:{id:"wager-payment"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#wager-payment"}},[e._v("#")]),e._v(" Wager payment")]),e._v(" "),o("p",[e._v("Now you need to decide how the tokens are moved. When a player accepts a challenge, the amount is deducted from the player's balance. But where does it go? You could decide to burn the tokens and re-mint them at a later date, but this would make the total supply fluctuate wildly for no apparent benefit.")]),e._v(" "),o("p",[e._v("It is possible to transfer from a player to a module. The module acts as the escrow account for all games. So when playing for the first time, a player would:")]),e._v(" "),o("div",{staticClass:"language-go extra-class"},[o("pre",{pre:!0,attrs:{class:"language-go"}},[o("code",[o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    sdk "),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"github.com/cosmos/cosmos-sdk/types"')]),e._v("\n    bankKeeper "),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"github.com/cosmos/cosmos-sdk/x/bank/keeper"')]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\nwager "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewCoin")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"stake"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewInt")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("storedGame"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Wager"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\npayment "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewCoins")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("wager"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" bank bankKeeper"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Keeper\n"),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" ctx sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Context\n"),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" playerAddress sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("AccAddress\nerr "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" bank"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("SendCoinsFromAccountToModule")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ctx"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" playerAddress"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"checkers"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" payment"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" err "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("nil")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" errors"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("New")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Player cannot pay the wager"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),o("p",[e._v("Notice how "),o("code",[e._v('"stake"')]),e._v(" identifies the likely name of the base token of your application, the token that is used with the consensus. Conversely, when paying a winner you would have:")]),e._v(" "),o("div",{staticClass:"language-go extra-class"},[o("pre",{pre:!0,attrs:{class:"language-go"}},[o("code",[e._v("amount "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewInt")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("storedGame"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Wager"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("Mul")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewInt")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),o("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nwinnings "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewCoin")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"stake"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" amount"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\npayment "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("NewCoins")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("winnings"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" winnerAddress sdk"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("AccAddress\nerr "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":=")]),e._v(" bank"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("SendCoinsFromModuleToAccount")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ctx"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"checkers"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" winnerAddress"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" payment"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" err "),o("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("nil")]),e._v(" "),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),o("span",{pre:!0,attrs:{class:"token function"}},[e._v("panic")]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),o("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Cannot pay the winnings to winner"')]),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),o("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),o("p",[e._v("Notice how:")]),e._v(" "),o("ul",[o("li",[e._v("It is a "),o("em",[e._v("standard")]),e._v(" error when the player cannot pay, which is "),o("em",[e._v("easily")]),e._v(" fixed by the player.")]),e._v(" "),o("li",[e._v("It is a panic (an internal error) when the escrow account cannot pay, because if the escrow cannot pay it means there is a logic problem somewhere.")])]),e._v(" "),o("p",[e._v("If you want to go beyond these code samples and instead see more in detail how to define all this, head to "),o("RouterLink",{attrs:{to:"/academy/4-my-own-chain/"}},[e._v("My Own Chain")]),e._v(".")],1)])],1)}),[],!1,null,null,null);t.default=a.exports}}]);