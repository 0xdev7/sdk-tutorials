(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{815:function(t,e,a){"use strict";a.r(e);var s=a(1),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"create-the-game-handling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-the-game-handling"}},[t._v("#")]),t._v(" Create the Game Handling")]),t._v(" "),a("HighlightBox",{attrs:{type:"synopsis"}},[a("p",[t._v("Make sure you have all you need before proceeding:")]),t._v(" "),a("ul",[a("li",[t._v("Have Go installed.")]),t._v(" "),a("li",[t._v("The checkers blockchain codebase with "),a("code",[t._v("MsgCreateGame")]),t._v(" created by Starport. You can get there by following the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/create-message.html"}},[t._v("previous steps")]),t._v(" checking out  "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/create-game-msg",target:"_blank",rel:"noopener noreferrer"}},[t._v("the relevant version"),a("OutboundLink")],1),t._v(".")],1)])]),t._v(" "),a("p",[t._v("You added the message to create a game along with its serialization and dedicated gRPC function with the help of Starport in the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/create-message.html"}},[t._v("previous section")]),t._v(".")],1),t._v(" "),a("p",[t._v("Now all that remains is to add code that:")]),t._v(" "),a("ul",[a("li",[t._v("Creates a brand new game.")]),t._v(" "),a("li",[t._v("Saves it in storage.")]),t._v(" "),a("li",[t._v("Returns the ID of the new game.")])]),t._v(" "),a("p",[t._v("Starport isolated this concern into a separate file, "),a("code",[t._v("x/checkers/keeper/msg_server_create_game.go")]),t._v(", for you to edit:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/e78cba34926ba0adee23febb1ce44774e2c466b3/x/checkers/keeper/msg_server_create_game.go#L10-L17] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("k msgServer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateGame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("goCtx context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MsgCreateGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MsgCreateGameResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" sdk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("UnwrapSDKContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("goCtx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TODO: Handling the message")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MsgCreateGameResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("All the message processing code were created for you and all you are left to do is code the meat of the action. Opting for Starport is a wise decision as you can see.")]),t._v(" "),a("p",[t._v("Given that you have already done a lot of preparatory work: what does it involve to code the action? With what do you replace "),a("code",[t._v("// TODO: Handling the message")]),t._v("?")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("First, "),a("code",[t._v("rules")]),t._v(" represent the ready-made file with the imported rules of the game:")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    rules "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/alice/checkers/x/checkers/rules"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Get the new game's ID:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/msg_server_create_game.go#L15-L19] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("nextGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" found "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Keeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetNextGame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("found "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NextGame not found"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nnewIndex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" strconv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("FormatUint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Using the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/next_game.go#L17",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Keeper.GetNextGame")]),a("OutboundLink")],1),t._v(" function created by the "),a("code",[t._v("starport scaffold single nextGame...")]),t._v(" command.")])]),t._v(" "),a("li",[a("p",[t._v("Create the object to be stored:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/msg_server_create_game.go#L20-L26] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("storedGame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StoredGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Creator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Creator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   newIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Game"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    rules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Red"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("     msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Red"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Black"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Black"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Notice the use of:")]),t._v(" "),a("ul",[a("li",[t._v("The "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/rules/checkers.go#L122",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("rules.New()")]),a("OutboundLink")],1),t._v(" command, which is part of the Checkers rules file you imported earlier.")]),t._v(" "),a("li",[t._v("The string content of the "),a("code",[t._v("msg *types.MsgCreateGame")]),t._v(" namely "),a("code",[t._v(".Creator")]),t._v(", "),a("code",[t._v(".Red")]),t._v(", and "),a("code",[t._v(".Black")]),t._v(".")])])]),t._v(" "),a("li",[a("p",[t._v("Confirm that the values in it are correct by checking the validity of the players' addresses:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/msg_server_create_game.go#L27-L30] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" storedGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Validate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The "),a("code",[t._v(".Creator")]),t._v(", "),a("code",[t._v(".Red")]),t._v(", and "),a("code",[t._v(".Black")]),t._v(" need to be checked because they were copied as "),a("strong",[t._v("strings")]),t._v(". The check on "),a("code",[t._v(".Creator")]),t._v(" is redundant here because at this stage the message's signatures have been verified and in particular the creator is the signer.")])]),t._v(" "),a("li",[a("p",[t._v("Save the "),a("code",[t._v("StoredGame")]),t._v(" object:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/msg_server_create_game.go#L31] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Keeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetStoredGame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" storedGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Using the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/stored_game.go#L10",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Keeper.SetStoredGame")]),a("OutboundLink")],1),t._v(" function created by the "),a("code",[t._v("starport scaffold map storedGame...")]),t._v(" command")])]),t._v(" "),a("li",[a("p",[t._v("Prepare the ground for the next game with:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/msg_server_create_game.go#L33-L34] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[t._v("nextGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IdValue"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\nk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Keeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetNextGame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextGame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("Using the "),a("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/next_game.go#L10",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Keeper.SetNextGame")]),a("OutboundLink")],1),t._v(" function created by Starport.")])]),t._v(" "),a("li",[a("p",[t._v("Return the newly created ID for reference:")]),t._v(" "),a("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/d59a74496a96018c57fdff72c443980c08416499/x/checkers/keeper/msg_server_create_game.go#L36-L38] extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MsgCreateGameResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    IdValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" newIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"next-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#next-up"}},[t._v("#")]),t._v(" Next up")]),t._v(" "),a("p",[t._v("You will modify this handling in the next sections:")]),t._v(" "),a("ul",[a("li",[t._v("To add "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[t._v("new fields")]),t._v(" to the stored information.")],1),t._v(" "),a("li",[t._v("To add "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/events.html"}},[t._v("an event")]),t._v(".")],1),t._v(" "),a("li",[t._v("To consume "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/gas-meter.html"}},[t._v("some gas")]),t._v(".")],1),t._v(" "),a("li",[t._v("To facilitate the eventual "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-forfeit.html"}},[t._v("deadline enforcement")]),t._v(".")],1),t._v(" "),a("li",[t._v("To add "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-wager.html"}},[a("em",[t._v("money")])]),t._v(" handling including "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/wager-denom.html"}},[t._v("foreign tokens")]),t._v(".")],1)]),t._v(" "),a("p",[t._v("Now that a game is created, it is time to play it. That is the subject of the "),a("RouterLink",{attrs:{to:"/academy/4-my-own-chain/play-game.html"}},[t._v("next section")]),t._v(".")],1)],1)}),[],!1,null,null,null);e.default=n.exports}}]);