(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{819:function(e,t,s){"use strict";s.r(t);var a=s(1),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"protobuf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#protobuf"}},[e._v("#")]),e._v(" Protobuf")]),e._v(" "),s("HighlightBox",{attrs:{type:"synopsis"}},[s("p",[e._v("Let's take a closer look at Protobuf. Before diving into the section a look at the following sections is recommended:")]),e._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/academy/2-main-concepts/messages.html"}},[e._v("Messages")])],1),e._v(" "),s("li",[s("RouterLink",{attrs:{to:"/academy/2-main-concepts/modules.html"}},[e._v("Modules")])],1)]),e._v(" "),s("p",[e._v("You can find a code example for your checkers blockchain at the end of the section to dive further into Protobuf and message creation.")])]),e._v(" "),s("p",[e._v("Protocol Buffers (Protobuf) is an open-source, extensible, cross-platform, and language-agnostic method of serializing object data primarily for network communication and storage. Libraries for multiple languages parse a common interface description language to generate source code for encoding and decoding streams of bytes representing structured data.")]),e._v(" "),s("p",[e._v("Originally designed and developed by Google, Protobuf has been an open-source project since 2008. It serves as a basis for Remote Procedure Call (RPC) systems.")]),e._v(" "),s("HighlightBox",{attrs:{type:"”info”"}},[s("p",[e._v("Google provides the "),s("a",{attrs:{href:"https://grpc.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("gRPC project"),s("OutboundLink")],1),e._v(". This universal RPC framework supports Protobuf directly. For more information on the process, take a look at the section entitled "),s("code",[e._v("Compiler Invocation")]),e._v(".")])]),e._v(" "),s("p",[s("code",[e._v(".proto")]),e._v(" files contain data structures called messages. The compiler "),s("code",[e._v("protoc")]),e._v(" interprets the "),s("code",[e._v(".proto")]),e._v(" file and generates source code in supported languages - C++, C#, Dart, Go, Java, and Python.")]),e._v(" "),s("h3",{attrs:{id:"working-with-protocol-buffers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#working-with-protocol-buffers"}},[e._v("#")]),e._v(" Working with Protocol Buffers")]),e._v(" "),s("p",[e._v("Define a data structure in a "),s("code",[e._v(".proto")]),e._v(" file. This is a normal text file with descriptive syntax. Data is represented as a message containing name-value pairs called fields.")]),e._v(" "),s("p",[e._v("Then, compile your Protobuf schema. "),s("code",[e._v(".protoc")]),e._v(" generates data access classes with accessors for each field in your preferred language according to the command-line options. Accessors include serializing, deserializing, and parsing.")]),e._v(" "),s("h2",{attrs:{id:"protobuf-basics-for-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#protobuf-basics-for-go"}},[e._v("#")]),e._v(" Protobuf basics for Go")]),e._v(" "),s("p",[e._v("The "),s("a",{attrs:{href:"https://golang.org/pkg/encoding/gob/",target:"_blank",rel:"noopener noreferrer"}},[e._v("gobs"),s("OutboundLink")],1),e._v(" package for Go is a comprehensive package for the Go environment. It does not work well if you need to share information with applications written in other languages. How to contend with fields that may themselves contain information needing to be parsed or encoded is another challenge.")]),e._v(" "),s("p",[e._v("For example, a JSON or XML object may contain discrete fields that are stored in a string field. In another example, a time may be stored as two integers representing hours and minutes. Protobuf encapsulates the necessary conversions in both directions. The generated classes provide getters and setters for the fields and take care of the details for reading and writing the message as a unit.")]),e._v(" "),s("p",[e._v("The Protobuf format supports extending the format over time in a way that code can still read data encoded in the old format.")]),e._v(" "),s("p",[e._v("Go developers access the setters and getters in the generated source code through the Go Protobuf API.")]),e._v(" "),s("HighlightBox",{attrs:{type:"”info”"}},[s("p",[e._v("For more on encoding in Cosmos, take a peek at "),s("a",{attrs:{href:"https://docs.cosmos.network/master/core/encoding.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("the Cosmos SDK documentation on encoding"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("p",[e._v("Here you can find the "),s("a",{attrs:{href:"https://docs.cosmos.network/master/core/proto-docs.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Protobuf documentation overview"),s("OutboundLink")],1),e._v(".")])]),e._v(" "),s("h2",{attrs:{id:"grpc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#grpc"}},[e._v("#")]),e._v(" gRPC")]),e._v(" "),s("p",[e._v("gRPC can use Protobuf as both its interface definition language and as its underlying message interchange format. A client can directly call a method on a server application on a different machine with gRPC as if it were a local object.")]),e._v(" "),s("p",[e._v("gRPC is based on the idea of defining a service and specifying the methods that can be called remotely with their parameters and return types. Keep the following in mind regarding the gRPC clients and server sides:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Server side.")]),e._v(" The server implements this interface and runs a gRPC server to handle client calls.")]),e._v(" "),s("li",[s("strong",[e._v("Client side.")]),e._v(" The client has a stub referred to as just a client in some languages that provides the same methods as the server.")])]),e._v(" "),s("p",[e._v("gRPC clients and servers can run and talk to each other in a variety of environments - from servers inside Google to your own desktop - and can be written in any of the gRPC’s supported languages. For example, you can easily create a gRPC server in Java with clients in Go, Python, or Ruby.")]),e._v(" "),s("p",[e._v("The latest Google APIs will have gRPC versions of their interfaces, letting you easily build Google functionality into your applications.")]),e._v(" "),s("h2",{attrs:{id:"types"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#types"}},[e._v("#")]),e._v(" Types")]),e._v(" "),s("p",[e._v("The core of a Cosmos SDK application mainly consists of type definitions and constructor functions. Defined in "),s("code",[e._v("app.go")]),e._v(", the type definition of a custom application is simply a "),s("code",[e._v("struct")]),e._v(" comprised of the following:")]),e._v(" "),s("ul",[s("li",[e._v("Reference to "),s("strong",[s("code",[e._v("BaseApp")])]),e._v(": a reference to the "),s("code",[e._v("BaseApp")]),e._v(" defines a custom application type embedding "),s("code",[e._v("BaseApp")]),e._v(" for your application. The reference to "),s("code",[e._v("BaseApp")]),e._v(" allows the custom application to inherit most of "),s("code",[e._v("BaseApp")]),e._v("'s core logic such as ABCI methods and the routing logic.")]),e._v(" "),s("li",[e._v("List of "),s("strong",[e._v("store keys")]),e._v(": each module in the Cosmos SDK uses a multistore to persist their part of the state. Access to such stores requires a list of keys that are declared in the type definition of the app.")]),e._v(" "),s("li",[e._v("List of each module's "),s("strong",[e._v("keepers")]),e._v(": a keeper is an abstract piece in each module to handle the module's interaction with stores, specify references to other modules' keepers, and implement other core functionalities of the module. For cross-module interactions to work, all modules in the Cosmos SDK need to have their keepers declared in the application's type definition and exported as interfaces to other modules so that the keeper's methods of one module can be called and accessed in other modules when authorized.")]),e._v(" "),s("li",[e._v("Reference to "),s("strong",[e._v("codec")]),e._v(": defaulted to go-amino, the codec in your Cosmos SDK application can be substituted with other suitable encoding frameworks as long as they persist data stores in byte slices and are deterministic.")]),e._v(" "),s("li",[e._v("Reference to the "),s("strong",[e._v("module manager")]),e._v(": a reference to an object containing a list of the applications modules known as the module manager.")])]),e._v(" "),s("ExpansionPanel",{attrs:{title:"Show me some code for my checkers' blockchain"}},[s("p",[e._v("In the previous code samples, you saw something like:")]),e._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" StoredGame "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    Creator "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("\n    Index "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The unique id that identifies this game.")]),e._v("\n    Game "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The serialized board.")]),e._v("\n    Turn "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('// "red" or "black"')]),e._v("\n    Red "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("\n    Black "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v("\n    Wager "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint64")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[e._v("With a "),s("em",[e._v("helpful")]),e._v(" note telling you that you still need to add serialization information like:")]),e._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" StoredGame "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    Creator "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('`protobuf:"bytes,1,opt,name=creator,proto3" json:"creator,omitempty"`')]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h2",{attrs:{id:"move-upstream"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#move-upstream"}},[e._v("#")]),e._v(" Move upstream")]),e._v(" "),s("p",[e._v("This is where Protobuf comes in to simplify your life even more. The same "),s("code",[e._v("StoredGame")]),e._v(" can in fact be declared as:")]),e._v(" "),s("div",{staticClass:"language-protobuf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-protobuf"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("message")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("StoredGame")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" creator "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" index "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" game "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" turn "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" red "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" black "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint64")]),e._v(" wager "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[e._v("The "),s("code",[e._v("= 1")]),e._v(" parts indicate how each field is identified in the serialized output and provide backward compatibility. As your application upgrades to newer versions make sure to not reuse numbers for new fields but to keep increasing the "),s("code",[e._v("= x")]),e._v(" value to preserve backward compatibility.")]),e._v(" "),s("p",[e._v("When "),s("em",[e._v("compiling")]),e._v(", Protobuf will add the "),s("code",[e._v('protobuf:"bytes..."')]),e._v(" elements. The messages to create a game can be declared in Protobuf similarly as:")]),e._v(" "),s("div",{staticClass:"language-protobuf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-protobuf"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("message")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MsgCreateGame")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" creator "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" red "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" black "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("uint64")]),e._v(" wager "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("message")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("MsgCreateGameResponse")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),e._v(" idValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("h2",{attrs:{id:"enter-starport"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enter-starport"}},[e._v("#")]),e._v(" Enter Starport")]),e._v(" "),s("p",[e._v("When Starport creates a message for you, it also creates the gRPC definitions and Go handling code. Using commands like the ones below makes it relatively easy to introduce Protobuf elements into your chain:")]),e._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[e._v("$ starport scaffold map storedGame game turn red black wager:uint --module checkers --no-message\n$ starport scaffold message createGame red black wager:uint --module checkers --response idValue\n")])])]),s("HighlightBox",{attrs:{type:"tip"}},[s("p",[e._v("If you want to dive straight into coding your chain, head to "),s("RouterLink",{attrs:{to:"/academy/4-my-own-chain/"}},[e._v("My Own Chain")]),e._v(" for more details on using Starport.")],1)])],1)],1)}),[],!1,null,null,null);t.default=n.exports}}]);