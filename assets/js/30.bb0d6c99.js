(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{612:function(e,t,o){e.exports=o.p+"assets/img/1.4d7ba008.png"},613:function(e,t,o){e.exports=o.p+"assets/img/2.adfea286.png"},677:function(e,t,o){"use strict";o.r(t);var a=o(0),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"polling-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#polling-app"}},[e._v("#")]),e._v(" Polling app")]),e._v(" "),a("p",[a("img",{attrs:{src:o(612),alt:"Application screenshot"}})]),e._v(" "),a("p",[e._v("We will be creating a simple poll application, in which a user can sign in, create polls, cast votes and see voting results. Creating a poll will cost 200 tokens, voting is free, and both actions will be available only for signed in users.")]),e._v(" "),a("h2",{attrs:{id:"requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[e._v("#")]),e._v(" Requirements")]),e._v(" "),a("p",[e._v("For this tutorial we will be using "),a("a",{attrs:{href:"https://github.com/tendermint/starport",target:"_blank",rel:"noopener noreferrer"}},[e._v("Starport"),a("OutboundLink")],1),e._v(" v0.14.0, an easy to use tool for building blockchains. To install "),a("code",[e._v("starport")]),e._v(" into "),a("code",[e._v("/usr/local/bin")]),e._v(", run the following command:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"Y3VybCBodHRwczovL2dldC5zdGFycG9ydC5uZXR3b3JrL3N0YXJwb3J0QHYwLjE0LjAhIHwgYmFzaAo="}}),e._v(" "),a("p",[e._v("You can also use Starport v0.14.0 on the web in a "),a("a",{attrs:{href:"http://gitpod.io/#https://github.com/tendermint/starport/tree/v0.14.0",target:"_blank",rel:"noopener noreferrer"}},[e._v("browser-based IDE"),a("OutboundLink")],1),e._v(". Learn more about other ways to "),a("a",{attrs:{href:"https://github.com/tendermint/starport/blob/develop/docs/1%20Introduction/2%20Install.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("install Starport"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"creating-a-blockchain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-blockchain"}},[e._v("#")]),e._v(" Creating a blockchain")]),e._v(" "),a("p",[e._v("Run the following command to create a voter project:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"c3RhcnBvcnQgYXBwIGdpdGh1Yi5jb20vYWxpY2Uvdm90ZXIgLS1zZGstdmVyc2lvbiBsYXVuY2hwYWQK"}}),e._v(" "),a("p",[e._v("Starport "),a("code",[e._v("app")]),e._v(" command will scaffold a project structure for your application in a "),a("code",[e._v("voter")]),e._v(" directory. Make sure to replace "),a("code",[e._v("alice")]),e._v(" with your GitHub username.")]),e._v(" "),a("p",[e._v("Inside the "),a("code",[e._v("voter")]),e._v(" directory we can see several files and directories:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"Y2Qgdm90ZXIK"}}),e._v(" "),a("ul",[a("li",[a("code",[e._v("app")]),e._v(" contains files that connect all of the moving parts of your application.")]),e._v(" "),a("li",[a("code",[e._v("cmd")]),e._v(" is responsible for "),a("code",[e._v("voterd")]),e._v(" and "),a("code",[e._v("votercli")]),e._v(" programs, which respectively allow you to start your application and interact with it.")]),e._v(" "),a("li",[a("code",[e._v("vue")]),e._v(" contains a web user interface for your app, reponsible for everything you see on the screenshot above.")]),e._v(" "),a("li",[a("code",[e._v("x")]),e._v(" contains the main building blocks of you app: modules. Right now we have only one: "),a("code",[e._v("voter")]),e._v(".")])]),e._v(" "),a("p",[e._v("Our project's directory contains all the code required to build and launch a blockchain-based app. Let's try launching our app by running starport serve inside our project:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"c3RhcnBvcnQgc2VydmUK"}}),e._v(" "),a("p",[e._v("You should be able to see the following output - "),a("em",[e._v("as well as any errors that might show up in your application.")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"8J+TpiBJbnN0YWxsaW5nIGRlcGVuZGVuY2llcy4uLgrwn5qnIEJ1aWxkaW5nIHRoZSBhcHBsaWNhdGlvbi4uLgrwn5KrIEluaXRpYWxpemluZyB0aGUgY2hhaW4uLi4K8J+ZgiBDcmVhdGVkIGFuIGFjY291bnQuIFBhc3N3b3JkIChtbmVtb25pYyk6IHRydXRoIHRvb3RoIGZyb250IGZhYnJpYyBzaW5nIGRpdmVydCB6b25lIG1pbGsgZmF0aWd1ZSB1cmJhbiBodW5kcmVkIGNlcnRhaW4gc29ycnkgbWVyZ2UgbWlsayB0cmVhdCBmb2FtIGNvcmFsIGFic2VudCBydW4gc3RhbmQgaW52ZXN0IG1vbmtleSBhc3BlY3QK8J+ZgiBDcmVhdGVkIGFuIGFjY291bnQuIFBhc3N3b3JkIChtbmVtb25pYyk6IGZhbW91cyBmYWN1bHR5IGdlbnJlIGZpbmdlciBidWlsZCBmYW50YXN5IHNxdWlycmVsIGljb24gY2FyYm9uIGFic2VudCBzbGVlcCB3ZWF0aGVyIGZvbGQgcGllY2UgdGhhbmsgZWFydGggcGlvbmVlciBleGNpdGUgdHJpbSBjdXBib2FyZCBncm93IHB1bXBraW4gYnVuZGxlIGF1Y3Rpb24K8J+MjSBSdW5uaW5nIGEgQ29zbW9zICd2b3RlcicgYXBwIHdpdGggVGVuZGVybWludC4KCvCfmoAgR2V0IHN0YXJ0ZWQ6IGh0dHA6Ly9sb2NhbGhvc3Q6MTIzNDUvCg=="}}),e._v(" "),a("p",[a("em",[e._v("Note: use")]),e._v(" "),a("code",[e._v("starport serve --verbose")]),e._v(" "),a("em",[e._v("to visualize detailed operations happening in the background")])]),e._v(" "),a("p",[e._v("Congratulations! You now have a blockchain application running on your machine in just two commands. It doesn't do anything yet, so let's work on that.")]),e._v(" "),a("p",[e._v("Our voting applications has two types of entities: polls and votes. A poll is a type that has a "),a("code",[e._v("title")]),e._v(" and a list of "),a("code",[e._v("options")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"adding-polls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-polls"}},[e._v("#")]),e._v(" Adding polls")]),e._v(" "),a("p",[e._v("Open a new terminal in "),a("code",[e._v("voter")]),e._v(" directory and run the following:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"c3RhcnBvcnQgdHlwZSBwb2xsIHRpdGxlIG9wdGlvbnMK"}}),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"8J+OiSBDcmVhdGVkIGEgdHlwZSBgcG9sbGAK"}}),e._v(" "),a("p",[e._v("This command generated code that handles the creation of "),a("code",[e._v("poll")]),e._v(" items. If we now run "),a("code",[e._v("starport serve")]),e._v(" and visit "),a("a",{attrs:{href:"http://localhost:8080",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:8080"),a("OutboundLink")],1),e._v(" we will see a form for creating polls. It may take a short while to rebuild the app, so give it a couple of seconds.")]),e._v(" "),a("p",[a("img",{attrs:{src:o(613),alt:"Application screenshot"}})]),e._v(" "),a("p",[e._v("Sign in with one of the passwords printed in the console and try creating a poll. You should see a new object created and displayed above the form. You have successfully created an object and stored it on the blockchain!")]),e._v(" "),a("p",[e._v("This, however, does not look and work exactly like we need. We should be able to add option fields (and store them as an array) and they should be displayed as interactive buttons.")]),e._v(" "),a("p",[e._v("Let's take a look at some of the files modified by the "),a("code",[e._v("starport type")]),e._v(" command.")]),e._v(" "),a("h3",{attrs:{id:"x-voter-types-typepoll-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-types-typepoll-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/types/TypePoll.go")])]),e._v(" "),a("p",[e._v("This file contains definition of the "),a("code",[e._v("Poll")]),e._v(" type. We can see that a poll has two fields (creator and ID), which will be created automatically, and two fields (title and options) defined by us. Since we want "),a("code",[e._v("Options")]),e._v(" to be a list of strings, "),a("strong",[e._v("replace "),a("code",[e._v("string")]),e._v(" with "),a("code",[e._v("[]string")])])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB0eXBlcwoKaW1wb3J0ICgKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CikKCnR5cGUgUG9sbCBzdHJ1Y3QgewoJQ3JlYXRvciBzZGsuQWNjQWRkcmVzcyBganNvbjomcXVvdDtjcmVhdG9yJnF1b3Q7IHlhbWw6JnF1b3Q7Y3JlYXRvciZxdW90O2AKCUlEICAgICAgc3RyaW5nICAgICAgICAgYGpzb246JnF1b3Q7aWQmcXVvdDsgeWFtbDomcXVvdDtpZCZxdW90O2AKCVRpdGxlICAgc3RyaW5nICAgICAgICAgYGpzb246JnF1b3Q7dGl0bGUmcXVvdDsgeWFtbDomcXVvdDt0aXRsZSZxdW90O2AKCU9wdGlvbnMgW11zdHJpbmcgICAgICAgYGpzb246JnF1b3Q7b3B0aW9ucyZxdW90OyB5YW1sOiZxdW90O29wdGlvbnMmcXVvdDtgCn0KCg=="}}),e._v(" "),a("h3",{attrs:{id:"x-voter-types-msgcreatepoll-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-types-msgcreatepoll-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/types/MsgCreatePoll.go")])]),e._v(" "),a("p",[e._v("This file defines a message that creates a poll.")]),e._v(" "),a("p",[e._v("We need to make options to be stored as a list instead of a string. Replace "),a("code",[e._v("Options string")]),e._v(" with "),a("code",[e._v("Options []string")]),e._v(" in "),a("code",[e._v("MsgCreatePoll")]),e._v(" struct and "),a("code",[e._v("options string")]),e._v(" with "),a("code",[e._v("options []string")]),e._v(" in the arguments of "),a("code",[e._v("NewMsgCreatePoll")]),e._v(" function.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB0eXBlcwoKaW1wb3J0ICgKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CglzZGtlcnJvcnMgJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay90eXBlcy9lcnJvcnMmcXVvdDsKKQoKdmFyIF8gc2RrLk1zZyA9ICZhbXA7TXNnQ3JlYXRlUG9sbHt9Cgp0eXBlIE1zZ0NyZWF0ZVBvbGwgc3RydWN0IHsKICBDcmVhdG9yIHNkay5BY2NBZGRyZXNzIGBqc29uOiZxdW90O2NyZWF0b3ImcXVvdDsgeWFtbDomcXVvdDtjcmVhdG9yJnF1b3Q7YAogIFRpdGxlIHN0cmluZyBganNvbjomcXVvdDt0aXRsZSZxdW90OyB5YW1sOiZxdW90O3RpdGxlJnF1b3Q7YAogIE9wdGlvbnMgW11zdHJpbmcgYGpzb246JnF1b3Q7b3B0aW9ucyZxdW90OyB5YW1sOiZxdW90O29wdGlvbnMmcXVvdDtgCn0KCmZ1bmMgTmV3TXNnQ3JlYXRlUG9sbChjcmVhdG9yIHNkay5BY2NBZGRyZXNzLCB0aXRsZSBzdHJpbmcsIG9wdGlvbnMgW11zdHJpbmcpIE1zZ0NyZWF0ZVBvbGwgewogIHJldHVybiBNc2dDcmVhdGVQb2xsewoJCUNyZWF0b3I6IGNyZWF0b3IsCiAgICBUaXRsZTogdGl0bGUsCiAgICBPcHRpb25zOiBvcHRpb25zLAoJfQp9CgouLi4K"}}),e._v(" "),a("p",[e._v("To write anything to a blockchain or perform any other state transition a client (web app in our case) makes an HTTP POST request with a title and options to "),a("a",{attrs:{href:"http://localhost:1317/voter/poll",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:1317/voter/poll"),a("OutboundLink")],1),e._v(" endpoint handler for which is defined in "),a("code",[e._v("x/voter/client/rest/txPoll.go")]),e._v(". The handler creates an unsigned transaction which contains an array of messages. The client then signs the transaction and sends it to "),a("a",{attrs:{href:"http://localhost:1317/txs",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:1317/txs"),a("OutboundLink")],1),e._v(". The application then processes the transaction by sending each message to a corresponding handler, in our case "),a("code",[e._v("x/voter/handlerMessageCreatePoll.go")]),e._v(". A handler then calls a "),a("code",[e._v("CreatePoll")]),e._v(" function defined in "),a("code",[e._v("x/voter/keeper/poll.go")]),e._v(" which writes the poll data into the store.")]),e._v(" "),a("h3",{attrs:{id:"x-voter-types-msgsetpoll-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-types-msgsetpoll-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/types/MsgSetPoll.go")])]),e._v(" "),a("p",[e._v("Also in the "),a("code",[e._v("MsgSetPoll")]),e._v(" we need to modify our "),a("code",[e._v("Options string")]),e._v(" to "),a("code",[e._v("[]string")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB0eXBlcwoKaW1wb3J0ICgKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CglzZGtlcnJvcnMgJnF1b3Q7Z2l0aHViLmNvbS9jb3Ntb3MvY29zbW9zLXNkay90eXBlcy9lcnJvcnMmcXVvdDsKKQoKdmFyIF8gc2RrLk1zZyA9ICZhbXA7TXNnU2V0UG9sbHt9Cgp0eXBlIE1zZ1NldFBvbGwgc3RydWN0IHsKCUlEICAgICAgc3RyaW5nICAgICAgICAgYGpzb246JnF1b3Q7aWQmcXVvdDsgeWFtbDomcXVvdDtpZCZxdW90O2AKCUNyZWF0b3Igc2RrLkFjY0FkZHJlc3MgYGpzb246JnF1b3Q7Y3JlYXRvciZxdW90OyB5YW1sOiZxdW90O2NyZWF0b3ImcXVvdDtgCglUaXRsZSAgIHN0cmluZyAgICAgICAgIGBqc29uOiZxdW90O3RpdGxlJnF1b3Q7IHlhbWw6JnF1b3Q7dGl0bGUmcXVvdDtgCglPcHRpb25zIFtdc3RyaW5nICAgICAgIGBqc29uOiZxdW90O29wdGlvbnMmcXVvdDsgeWFtbDomcXVvdDtvcHRpb25zJnF1b3Q7YAp9CgpmdW5jIE5ld01zZ1NldFBvbGwoY3JlYXRvciBzZGsuQWNjQWRkcmVzcywgaWQgc3RyaW5nLCB0aXRsZSBzdHJpbmcsIG9wdGlvbnMgW11zdHJpbmcpIE1zZ1NldFBvbGwgewoJcmV0dXJuIE1zZ1NldFBvbGx7CgkJSUQ6ICAgICAgaWQsCgkJQ3JlYXRvcjogY3JlYXRvciwKCQlUaXRsZTogICB0aXRsZSwKCQlPcHRpb25zOiBvcHRpb25zLAoJfQp9CgouLi4K"}}),e._v(" "),a("h3",{attrs:{id:"x-voter-client-rest-txpoll-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-client-rest-txpoll-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/client/rest/txPoll.go")])]),e._v(" "),a("p",[e._v("Replace "),a("code",[e._v("Options string")]),e._v(" with "),a("code",[e._v("Options []string")]),e._v(" in "),a("code",[e._v("createPollRequest")]),e._v(" struct.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBjcmVhdGVQb2xsUmVxdWVzdCBzdHJ1Y3QgewoJQmFzZVJlcSByZXN0LkJhc2VSZXEgYGpzb246JnF1b3Q7YmFzZV9yZXEmcXVvdDtgCglDcmVhdG9yIHN0cmluZyBganNvbjomcXVvdDtjcmVhdG9yJnF1b3Q7YAoJVGl0bGUgc3RyaW5nIGBqc29uOiZxdW90O3RpdGxlJnF1b3Q7YAoJT3B0aW9ucyBbXXN0cmluZyBganNvbjomcXVvdDtvcHRpb25zJnF1b3Q7YAp9Cg=="}}),e._v(" "),a("p",[e._v("Also further below in the "),a("code",[e._v("setPollRequest")]),e._v(" struct.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBzZXRQb2xsUmVxdWVzdCBzdHJ1Y3QgewoJQmFzZVJlcSByZXN0LkJhc2VSZXEgYGpzb246JnF1b3Q7YmFzZV9yZXEmcXVvdDtgCglJRCAgICAgIHN0cmluZyAgICAgICBganNvbjomcXVvdDtpZCZxdW90O2AKCUNyZWF0b3Igc3RyaW5nICAgICAgIGBqc29uOiZxdW90O2NyZWF0b3ImcXVvdDtgCglUaXRsZSAgIHN0cmluZyAgICAgICBganNvbjomcXVvdDt0aXRsZSZxdW90O2AKCU9wdGlvbnMgW11zdHJpbmcgICAgIGBqc29uOiZxdW90O29wdGlvbnMmcXVvdDtgCn0K"}}),e._v(" "),a("h3",{attrs:{id:"x-voter-client-cli-txpoll-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-client-cli-txpoll-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/client/cli/txPoll.go")])]),e._v(" "),a("p",[e._v("A user will also be able to interact with our application through a command line interface.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"dm90ZXJjbGkgdHggdm90ZXIgY3JlYXRlLXBvbGwgJnF1b3Q7VGV4dCBlZGl0b3JzJnF1b3Q7ICZxdW90O0VtYWNzJnF1b3Q7ICZxdW90O1ZpbSZxdW90OyAtLWZyb20gdXNlcjEK"}}),e._v(" "),a("p",[e._v('This command will generate a transaction with "create poll" message, sign it using a private key of '),a("code",[e._v("user1")]),e._v(" (one of two users created by default) and broadcast it to the blockchain.")]),e._v(" "),a("p",[e._v("The modification we need to make is to change a line that reads arguments from the console.")]),e._v(" "),a("p",[e._v("In the function "),a("code",[e._v("GetCmdCreatePoll")])]),e._v(" "),a("p",[e._v("replace")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"QXJnczogIGNvYnJhLkV4YWN0QXJncygyKSwK"}}),e._v(" "),a("p",[e._v("with")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"QXJnczogIGNvYnJhLk1pbmltdW1OQXJncygyKSwK"}}),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YXJnc09wdGlvbnMgOj0gYXJnc1sxOmxlbihhcmdzKV0K"}}),e._v(" "),a("p",[e._v("The variable "),a("code",[e._v("msg")]),e._v(" is defined to read a string of argOptions, delete the stringification")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"bXNnIDo9IHR5cGVzLk5ld01zZ0NyZWF0ZVBvbGwoY2xpQ3R4LkdldEZyb21BZGRyZXNzKCksIHN0cmluZyhhcmdzVGl0bGUpLCBhcmdzT3B0aW9ucykK"}}),e._v(" "),a("p",[e._v("We end up with the following function")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBHZXRDbWRDcmVhdGVQb2xsKGNkYyAqY29kZWMuQ29kZWMpICpjb2JyYS5Db21tYW5kIHsKCXJldHVybiAmYW1wO2NvYnJhLkNvbW1hbmR7CgkJVXNlOiAgICZxdW90O2NyZWF0ZS1wb2xsIFt0aXRsZV0gW29wdGlvbnNdJnF1b3Q7LAoJCVNob3J0OiAmcXVvdDtDcmVhdGVzIGEgbmV3IHBvbGwmcXVvdDssCgkJQXJnczogIGNvYnJhLk1pbmltdW1OQXJncygyKSwKCQlSdW5FOiBmdW5jKGNtZCAqY29icmEuQ29tbWFuZCwgYXJncyBbXXN0cmluZykgZXJyb3IgewoJCQlhcmdzVGl0bGUgOj0gc3RyaW5nKGFyZ3NbMF0pCgkJCWFyZ3NPcHRpb25zIDo9IGFyZ3NbMTpsZW4oYXJncyldCgoJCQljbGlDdHggOj0gY29udGV4dC5OZXdDTElDb250ZXh0KCkuV2l0aENvZGVjKGNkYykKCQkJaW5CdWYgOj0gYnVmaW8uTmV3UmVhZGVyKGNtZC5Jbk9yU3RkaW4oKSkKCQkJdHhCbGRyIDo9IGF1dGguTmV3VHhCdWlsZGVyRnJvbUNMSShpbkJ1ZikuV2l0aFR4RW5jb2Rlcih1dGlscy5HZXRUeEVuY29kZXIoY2RjKSkKCQkJbXNnIDo9IHR5cGVzLk5ld01zZ0NyZWF0ZVBvbGwoY2xpQ3R4LkdldEZyb21BZGRyZXNzKCksIHN0cmluZyhhcmdzVGl0bGUpLCBhcmdzT3B0aW9ucykKCQkJZXJyIDo9IG1zZy5WYWxpZGF0ZUJhc2ljKCkKCQkJaWYgZXJyICE9IG5pbCB7CgkJCQlyZXR1cm4gZXJyCgkJCX0KCQkJcmV0dXJuIHV0aWxzLkdlbmVyYXRlT3JCcm9hZGNhc3RNc2dzKGNsaUN0eCwgdHhCbGRyLCBbXXNkay5Nc2d7bXNnfSkKCQl9LAoJfQp9Cg=="}}),e._v(" "),a("p",[e._v("The same changes will need to be done for the function "),a("code",[e._v("GetCmdSetPoll")])]),e._v(" "),a("p",[e._v("And in the "),a("code",[e._v("GetCmdSetPoll")]),e._v(" we set")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"QXJnczogIGNvYnJhLkV4YWN0QXJncygzKSwK"}}),e._v(" "),a("p",[e._v("to")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"QXJnczogIGNvYnJhLk1pbmltdW1OQXJncygzKSwK"}}),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YXJnc09wdGlvbnMgOj0gYXJnc1syOmxlbihhcmdzKV0K"}}),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"bXNnIDo9IHR5cGVzLk5ld01zZ1NldFBvbGwoY2xpQ3R4LkdldEZyb21BZGRyZXNzKCksIGlkLCBzdHJpbmcoYXJnc1RpdGxlKSwgYXJnc09wdGlvbnMpCg=="}}),e._v(" "),a("p",[e._v("This will assume that all arguments after the first one represent a list of options.")]),e._v(" "),a("p",[e._v("We end up with the following function")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBHZXRDbWRTZXRQb2xsKGNkYyAqY29kZWMuQ29kZWMpICpjb2JyYS5Db21tYW5kIHsKCXJldHVybiAmYW1wO2NvYnJhLkNvbW1hbmR7CgkJVXNlOiAgICZxdW90O3NldC1wb2xsIFtpZF0gIFt0aXRsZV0gW29wdGlvbnNdJnF1b3Q7LAoJCVNob3J0OiAmcXVvdDtTZXQgYSBuZXcgcG9sbCZxdW90OywKCQlBcmdzOiAgY29icmEuTWluaW11bU5BcmdzKDMpLAoJCVJ1bkU6IGZ1bmMoY21kICpjb2JyYS5Db21tYW5kLCBhcmdzIFtdc3RyaW5nKSBlcnJvciB7CgkJCWlkIDo9IGFyZ3NbMF0KCQkJYXJnc1RpdGxlIDo9IHN0cmluZyhhcmdzWzFdKQoJCQlhcmdzT3B0aW9ucyA6PSBhcmdzWzI6bGVuKGFyZ3MpXQoKCQkJY2xpQ3R4IDo9IGNvbnRleHQuTmV3Q0xJQ29udGV4dCgpLldpdGhDb2RlYyhjZGMpCgkJCWluQnVmIDo9IGJ1ZmlvLk5ld1JlYWRlcihjbWQuSW5PclN0ZGluKCkpCgkJCXR4QmxkciA6PSBhdXRoLk5ld1R4QnVpbGRlckZyb21DTEkoaW5CdWYpLldpdGhUeEVuY29kZXIodXRpbHMuR2V0VHhFbmNvZGVyKGNkYykpCgkJCW1zZyA6PSB0eXBlcy5OZXdNc2dTZXRQb2xsKGNsaUN0eC5HZXRGcm9tQWRkcmVzcygpLCBpZCwgc3RyaW5nKGFyZ3NUaXRsZSksIGFyZ3NPcHRpb25zKQoJCQllcnIgOj0gbXNnLlZhbGlkYXRlQmFzaWMoKQoJCQlpZiBlcnIgIT0gbmlsIHsKCQkJCXJldHVybiBlcnIKCQkJfQoJCQlyZXR1cm4gdXRpbHMuR2VuZXJhdGVPckJyb2FkY2FzdE1zZ3MoY2xpQ3R4LCB0eEJsZHIsIFtdc2RrLk1zZ3ttc2d9KQoJCX0sCgl9Cn0K"}}),e._v(" "),a("p",[e._v("Now that we have made all the necessary changes to our app, let's take a look at the client-side application.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"",base64:"c3RhcnBvcnQgc2VydmUK"}}),e._v(" "),a("h3",{attrs:{id:"front-end-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#front-end-application"}},[e._v("#")]),e._v(" Front-end application")]),e._v(" "),a("p",[e._v("Starport has generated a basic front-end for our application. For convenience "),a("a",{attrs:{href:"https://vuejs.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vue.js"),a("OutboundLink")],1),e._v(" framework is used with "),a("a",{attrs:{href:"https://vuex.vuejs.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vuex"),a("OutboundLink")],1),e._v(" for state management, but since all features of our application are exposed through an HTTP API, clients can be built using any language or framework.")]),e._v(" "),a("p",[e._v("We'll be mostly interested in "),a("code",[e._v("vue/src/views")]),e._v(" directory, which contains page templates of our app, "),a("code",[e._v("vue/src/store/index.js")]),e._v(" handles sending transactions and receiving data from our blockchain and "),a("a",{attrs:{href:"https://github.com/tendermint/vue/",target:"_blank",rel:"noopener noreferrer"}},[a("code",[e._v("@tendermint/vue")]),a("OutboundLink")],1),e._v(" directory, which contains components, like buttons and forms.")]),e._v(" "),a("p",[e._v("Inside "),a("code",[e._v("vue/src/store/index.js")]),e._v(" we import "),a("a",{attrs:{href:"https://github.com/tendermint/vue/blob/develop/src/store/cosmos.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("@tendermint/vue/src/store/cosmos"),a("OutboundLink")],1),e._v(" which uses "),a("a",{attrs:{href:"https://github.com/cosmwasm/cosmjs",target:"_blank",rel:"noopener noreferrer"}},[e._v("CosmJS"),a("OutboundLink")],1),e._v(", a library for handling wallets, creating, signing and broadcasting transactions and define a Vuex store. We'll use "),a("code",[e._v("entitySubmit")]),e._v(" function for sending data to our blockchain (like a JSON representing a newly created poll), "),a("code",[e._v("entityFetch")]),e._v(" for requesting a list of polls and "),a("code",[e._v("accountUpdate")]),e._v(" to fetch information about our token balance.")]),e._v(" "),a("h3",{attrs:{id:"vue-src-views-index-vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-views-index-vue"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/views/Index.vue")])]),e._v(" "),a("p",[e._v("Since we don't need the default form component replace")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Jmx0O3NwLXR5cGUtZm9ybSB0eXBlPSZxdW90O3BvbGwmcXVvdDsgOmZpZWxkcz0mcXVvdDtbJ3RpdGxlJywgJ29wdGlvbnMnLCBdJnF1b3Q7IG1vZHVsZT0mcXVvdDt2b3RlciZxdW90OyAvJmd0Owo="}}),e._v(" "),a("p",[e._v("inside of "),a("code",[e._v("vue/src/views/Index.vue")]),e._v(" with a new component and a Title")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Jmx0O1NwSDMmZ3Q7CiBQb2xscwombHQ7L1NwSDMmZ3Q7CiZsdDtwb2xsLWZvcm0gLyZndDsK"}}),e._v(" "),a("p",[e._v("In the "),a("code",[e._v("<script><\/script>")]),e._v(" tags below, we import our component like this")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"aW1wb3J0ICogYXMgc3AgZnJvbSAmcXVvdDtAdGVuZGVybWludC92dWUmcXVvdDs7CmltcG9ydCBQb2xsRm9ybSBmcm9tICZxdW90Oy4uL2NvbXBvbmVudHMvUG9sbEZvcm0mcXVvdDs7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBQb2xsRm9ybSwgLi4uc3AgfSwKfTsK"}}),e._v(" "),a("p",[e._v("For our PollForm we need to create a new directory "),a("code",[e._v("components")]),e._v(" in our "),a("code",[e._v("vue/src/")]),e._v(" path. In this directory we create a new file "),a("code",[e._v("PollForm.vue")]),e._v(" and fill our first component with life.")]),e._v(" "),a("h3",{attrs:{id:"vue-src-components-pollform-vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-components-pollform-vue"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/components/PollForm.vue")])]),e._v(" "),a("p",[e._v("We create our PollForm component. Which will have a title and two buttons.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Jmx0O3RlbXBsYXRlJmd0OwogICZsdDtkaXYmZ3Q7CiAgICAmbHQ7c3AtaW5wdXQgcGxhY2Vob2xkZXI9JnF1b3Q7VGl0bGUmcXVvdDsgdi1tb2RlbD0mcXVvdDt0aXRsZSZxdW90OyAvJmd0OwogICAgJmx0O2RpdiB2LWZvcj0mcXVvdDtvcHRpb24gaW4gb3B0aW9ucyZxdW90OyZndDsKICAgICAgJmx0O3NwLWlucHV0IHBsYWNlaG9sZGVyPSZxdW90O09wdGlvbiZxdW90OyB2LW1vZGVsPSZxdW90O29wdGlvbi50aXRsZSZxdW90OyAvJmd0OwogICAgJmx0Oy9kaXYmZ3Q7CiAgICAmbHQ7c3AtYnV0dG9uIEBjbGljay5uYXRpdmU9JnF1b3Q7YWRkJnF1b3Q7Jmd0OysgQWRkIG9wdGlvbiZsdDsvc3AtYnV0dG9uJmd0OwogICAgJmx0O3NwLWJ1dHRvbiBAY2xpY2submF0aXZlPSZxdW90O3N1Ym1pdCZxdW90OyZndDtDcmVhdGUgcG9sbCZsdDsvc3AtYnV0dG9uJmd0OwogICZsdDsvZGl2Jmd0OwombHQ7L3RlbXBsYXRlJmd0Owo="}}),e._v(" "),a("p",[e._v("in between "),a("code",[e._v("<script><\/script>")]),e._v(" tags below this:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"aW1wb3J0ICogYXMgc3AgZnJvbSAmcXVvdDtAdGVuZGVybWludC92dWUmcXVvdDs7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IC4uLnNwIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHRpdGxlOiAmcXVvdDsmcXVvdDssCiAgICAgIG9wdGlvbnM6IFtdCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgYWRkKCkgewogICAgICB0aGlzLm9wdGlvbnMgPSBbLi4udGhpcy5vcHRpb25zLCB7IHRpdGxlOiAmcXVvdDsmcXVvdDsgfV07CiAgICB9LAogICAgYXN5bmMgc3VibWl0KCkgewogICAgICBjb25zdCBwYXlsb2FkID0gewogICAgICAgIHR5cGU6ICZxdW90O3BvbGwmcXVvdDssCiAgICAgICAgbW9kdWxlOiAmcXVvdDt2b3RlciZxdW90OywKICAgICAgICBib2R5OiB7CiAgICAgICAgICB0aXRsZTogdGhpcy50aXRsZSwKICAgICAgICAgIG9wdGlvbnM6IHRoaXMub3B0aW9ucy5tYXAobyA9Jmd0OyBvLnRpdGxlKQogICAgICAgIH0KICAgICAgfTsKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJnF1b3Q7Y29zbW9zL2VudGl0eVN1Ym1pdCZxdW90OywgcGF5bG9hZCk7CiAgICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJnF1b3Q7Y29zbW9zL2VudGl0eUZldGNoJnF1b3Q7LCBwYXlsb2FkKTsKICAgIH0KICB9Cn07Cg=="}}),e._v(" "),a("p",[e._v("We also need to setup our Vue store.")]),e._v(" "),a("h3",{attrs:{id:"vue-src-store-index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-store-index-js"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/store/index.js")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"aW1wb3J0IFZ1ZSBmcm9tICZxdW90O3Z1ZSZxdW90OzsKaW1wb3J0IFZ1ZXggZnJvbSAmcXVvdDt2dWV4JnF1b3Q7OwppbXBvcnQgY29zbW9zIGZyb20gJnF1b3Q7QHRlbmRlcm1pbnQvdnVlL3NyYy9zdG9yZS9jb3Ntb3MuanMmcXVvdDs7CgpWdWUudXNlKFZ1ZXgpOwoKZXhwb3J0IGRlZmF1bHQgbmV3IFZ1ZXguU3RvcmUoewogIG1vZHVsZXM6IHsgY29zbW9zIH0sCn0pOwoK"}}),e._v(" "),a("p",[e._v("In our main "),a("code",[e._v("App.vue")]),e._v(" file, we make sure to initialize the Cosmos Wallet functions that we created as follows:")]),e._v(" "),a("h3",{attrs:{id:"vue-src-app-vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-app-vue"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/App.vue")])]),e._v(" "),a("p",[e._v("In the "),a("code",[e._v("<script><\/script>")]),e._v(" tag at the end of the file, we dispatch to initialize our own app and the cosmos Vue framework")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgmcXVvdDtjb3Ntb3MvaW5pdCZxdW90Oyk7CiAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgmcXVvdDtjb3Ntb3MvZW50aXR5RmV0Y2gmcXVvdDssIHt0eXBlOiAmcXVvdDtwb2xsJnF1b3Q7LCBtb2R1bGU6ICZxdW90O3ZvdGVyJnF1b3Q7fSk7CiAgfSwKfTsK"}}),e._v(" "),a("p",[e._v("Refresh the page, sign in with a password and create a new poll. It takes a couple of seconds to process a transaction. Now, if you visit "),a("a",{attrs:{href:"http://localhost:1317/voter/poll",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:1317/voter/poll"),a("OutboundLink")],1),e._v(" you should see a list of polls (this endpoint is defined in "),a("code",[e._v("x/voter/rest/queryPoll.go")]),e._v("):")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ewogICZxdW90O2hlaWdodCZxdW90OzogJnF1b3Q7MCZxdW90OywKICAmcXVvdDtyZXN1bHQmcXVvdDs6IFsKICAgIHsKICAgICAgJnF1b3Q7Y3JlYXRvciZxdW90OzogJnF1b3Q7Y29zbW9zMTlxcWE3ajczNzM1dzRwY3g5bWtrYXhyMDBhZjdwNDMybjYydHY2JnF1b3Q7LAogICAgICAmcXVvdDtpZCZxdW90OzogJnF1b3Q7ODI2NDc3YWItMDAwNS00ZTY4LTgwMzEtMTk3NThkMzMxNjgxJnF1b3Q7LAogICAgICAmcXVvdDt0aXRsZSZxdW90OzogJnF1b3Q7QSBwb2xsIHRpdGxlJnF1b3Q7LAogICAgICAmcXVvdDtvcHRpb25zJnF1b3Q7OiBbJnF1b3Q7Rmlyc3Qgb3B0aW9uJnF1b3Q7LCAmcXVvdDtUaGUgc2Vjb25kIG9wdGlvbiZxdW90O10KICAgIH0KICBdCn0K"}}),e._v(" "),a("h2",{attrs:{id:"adding-votes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-votes"}},[e._v("#")]),e._v(" Adding votes")]),e._v(" "),a("p",[e._v("A vote type contains poll ID and a value (string representation of the selected option).")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"c3RhcnBvcnQgdHlwZSB2b3RlIHBvbGxJRCB2YWx1ZQo="}}),e._v(" "),a("h3",{attrs:{id:"vue-src-views-index-vue-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-views-index-vue-2"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/views/Index.vue")])]),e._v(" "),a("p",[e._v("Delete the just bootstrapped for us "),a("code",[e._v('<sp-type-form type="vote" :fields="[\'pollID\', \'value\', ]" module="voter" />')]),e._v(".\nAdd "),a("code",[e._v("<poll-list />")]),e._v(" into the "),a("code",[e._v("vue/src/view/Index.vue")]),e._v(" file after the poll form component we just created.")]),e._v(" "),a("p",[e._v("Update the imports below in the "),a("code",[e._v("<script><\/script>")]),e._v(" tags as follows:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"aW1wb3J0ICogYXMgc3AgZnJvbSAmcXVvdDtAdGVuZGVybWludC92dWUmcXVvdDs7CmltcG9ydCBQb2xsRm9ybSBmcm9tICZxdW90Oy4uL2NvbXBvbmVudHMvUG9sbEZvcm0mcXVvdDs7CmltcG9ydCBQb2xsTGlzdCBmcm9tICZxdW90Oy4uL2NvbXBvbmVudHMvUG9sbExpc3QmcXVvdDs7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogeyBQb2xsRm9ybSwgUG9sbExpc3QsIC4uLnNwIH0sCn07Cg=="}}),e._v(" "),a("p",[e._v("Then make a new component at "),a("code",[e._v("vue/src/components/PollList.vue")]),e._v(" and add the following:")]),e._v(" "),a("h3",{attrs:{id:"vue-src-components-polllist-vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-components-polllist-vue"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/components/PollList.vue")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Jmx0O3RlbXBsYXRlJmd0OwogICZsdDtkaXYmZ3Q7CiAgICAKICAgICZsdDtkaXYgdi1mb3I9JnF1b3Q7cG9sbCBpbiBwb2xscyZxdW90OyB2LWJpbmQ6a2V5PSZxdW90O3BvbGwuaWQmcXVvdDsmZ3Q7CiAgICAgICZsdDtTcEgzJmd0OwogICAgICAgIFBvbGwge3sgcG9sbC50aXRsZSB9fQogICAgICAmbHQ7L1NwSDMmZ3Q7CiAgICAgICZsdDthcHAtcmFkaW8taXRlbQogICAgICAgIEBjbGljay5uYXRpdmU9JnF1b3Q7c3VibWl0KHBvbGwuaWQsIG9wdGlvbikmcXVvdDsKICAgICAgICB2LWZvcj0mcXVvdDtvcHRpb24gaW4gcG9sbC5vcHRpb25zJnF1b3Q7CiAgICAgICAgdi1iaW5kOmtleT0mcXVvdDtvcHRpb24mcXVvdDsKICAgICAgICA6dmFsdWU9JnF1b3Q7b3B0aW9uJnF1b3Q7CiAgICAgIC8mZ3Q7CiAgICAgICZsdDthcHAtdGV4dCB0eXBlPSZxdW90O3N1YnRpdGxlJnF1b3Q7Jmd0O1Jlc3VsdHM6IHt7IHJlc3VsdHMocG9sbC5pZCkgfX0mbHQ7L2FwcC10ZXh0Jmd0OwogICAgJmx0Oy9kaXYmZ3Q7CiAgJmx0Oy9kaXYmZ3Q7CiZsdDsvdGVtcGxhdGUmZ3Q7Cg=="}}),e._v(" "),a("p",[e._v("in between "),a("code",[e._v("<script><\/script>")]),e._v(" tags below this:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"aW1wb3J0ICogYXMgc3AgZnJvbSAmcXVvdDtAdGVuZGVybWludC92dWUmcXVvdDs7CmltcG9ydCBBcHBSYWRpb0l0ZW0gZnJvbSAmcXVvdDsuL0FwcFJhZGlvSXRlbSZxdW90OzsKaW1wb3J0IEFwcFRleHQgZnJvbSAmcXVvdDsuL0FwcFRleHQmcXVvdDs7CmltcG9ydCB7Y291bnRCeSB9IGZyb20gJnF1b3Q7bG9kYXNoJnF1b3Q7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7IEFwcFRleHQsIEFwcFJhZGlvSXRlbSwgLi4uc3AgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc2VsZWN0ZWQ6ICZxdW90OyZxdW90OwogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBwb2xscygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLmNvc21vcy5kYXRhWyZxdW90O3ZvdGVyL3BvbGwmcXVvdDtdIHx8IFtdOwogICAgfSwKICAgIHZvdGVzKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuY29zbW9zLmRhdGFbJnF1b3Q7dm90ZXIvdm90ZSZxdW90O10gfHwgW107CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICByZXN1bHRzKGlkKSB7CiAgICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLnZvdGVzLmZpbHRlcih2ID0mZ3Q7IHYucG9sbElEID09PSBpZCk7CiAgICAgIHJldHVybiBjb3VudEJ5KHJlc3VsdHMsICZxdW90O3ZhbHVlJnF1b3Q7KTsKICAgIH0sCiAgICBhc3luYyBzdWJtaXQocG9sbElELCB2YWx1ZSkgewogICAgICBjb25zdCB0eXBlID0geyB0eXBlOiAmcXVvdDt2b3RlJnF1b3Q7IH07CiAgICAgIGNvbnN0IGJvZHkgPSB7IHBvbGxJRCwgdmFsdWUgfTsKICAgICAgYXdhaXQgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJnF1b3Q7Y29zbW9zL2VudGl0eVN1Ym1pdCZxdW90OywgeyAuLi50eXBlLCBtb2R1bGU6JnF1b3Q7dm90ZXImcXVvdDssIGJvZHkgfSk7CiAgICAgIGF3YWl0IHRoaXMuJHN0b3JlLmRpc3BhdGNoKCZxdW90O2Nvc21vcy9lbnRpdHlGZXRjaCZxdW90Oywgey4uLnR5cGUsIG1vZHVsZTogJnF1b3Q7dm90ZXImcXVvdDt9KTsKICAgIH0KICB9Cn07Cg=="}}),e._v(" "),a("p",[e._v("The "),a("code",[e._v("PollList")]),e._v(" component lists for every poll, all the options for that poll, as buttons. Selecting an option triggers a "),a("code",[e._v("submit")]),e._v(' method that broadcasts a transaction with a "create vote" message and fetches data back from our application.')]),e._v(" "),a("p",[e._v("Two components are still missing from our App, to make it a bit better looking. Let's add "),a("code",[e._v("AppRadioItem.vue")]),e._v(" and "),a("code",[e._v("AppText.vue")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"vue-src-components-appradioitem-vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-components-appradioitem-vue"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/components/AppRadioItem.vue")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Jmx0O3RlbXBsYXRlJmd0OwogICZsdDtkaXYmZ3Q7CiAgICAmbHQ7YnV0dG9uIGNsYXNzPSZxdW90O2J1dHRvbiZxdW90OyZndDt7eyB2YWx1ZSB9fSZsdDsvYnV0dG9uJmd0OwogICZsdDsvZGl2Jmd0OwombHQ7L3RlbXBsYXRlJmd0OwoKJmx0O3N0eWxlIHNjb3BlZCZndDsKLmJ1dHRvbiB7CiAgYm94LXNoYWRvdzogaW5zZXQgMCAwIDAgMXB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKICBwYWRkaW5nOiAwLjc1cmVtIDFyZW07CiAgbWFyZ2luLWJvdHRvbTogMC41cmVtOwogIGJvcmRlci1yYWRpdXM6IDZweDsKICB1c2VyLXNlbGVjdDogbm9uZTsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYWxsIDAuMXM7CiAgZm9udC13ZWlnaHQ6IDUwMDsKICBvdXRsaW5lOiBub25lOwogIGJvcmRlcjogbm9uZTsKICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuMDEpOwogIHdpZHRoOiAxMDAlOwogIGZvbnQtZmFtaWx5OiBpbmhlcml0OwogIHRleHQtYWxpZ246IGxlZnQ7CiAgZm9udC1zaXplOiAxcmVtOwogIGZvbnQtd2VpZ2h0OiBpbmhlcml0Owp9Ci5idXR0b246aG92ZXIgewogIGJveC1zaGFkb3c6IGluc2V0IDAgMCAwIDFweCByZ2JhKDAsIDAsIDAsIDAuMSksCiAgICAwIDFweCA1cHggLTFweCByZ2JhKDAsIDAsIDAsIDAuMSk7Cn0KLmJ1dHRvbjpmb2N1cyB7CiAgYm94LXNoYWRvdzogaW5zZXQgMCAwIDAgMXB4IHJnYmEoMCwgMCwgMCwgMC4yKSwKICAgIDAgMXB4IDVweCAtMXB4IHJnYmEoMCwgMCwgMCwgMC4xKTsKfQouYnV0dG9uOmFjdGl2ZSB7CiAgYm94LXNoYWRvdzogaW5zZXQgMCAwIDAgMXB4IHJnYmEoMCwgMCwgMCwgMC4wNyk7CiAgY29sb3I6IHJnYmEoMCwgMCwgMCwgMC43KTsKICB0cmFuc2Zvcm06IHNjYWxlKDAuOTk4KTsKfQombHQ7L3N0eWxlJmd0Owo="}}),e._v(" "),a("p",[e._v("In the "),a("code",[e._v("<script><\/script>")]),e._v(" tag below this:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICB2YWx1ZTogJnF1b3Q7JnF1b3Q7LAogIH0sCn07Cg=="}}),e._v(" "),a("h3",{attrs:{id:"vue-src-components-apptext-vue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-components-apptext-vue"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/components/AppText.vue")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"Jmx0O3RlbXBsYXRlJmd0OwogICZsdDtkaXYmZ3Q7CiAgICAmbHQ7ZGl2IDpjbGFzcz0mcXVvdDtbYCR7dHlwZX1gXSZxdW90OyZndDsKICAgICAgJmx0O3Nsb3QgLyZndDsKICAgICZsdDsvZGl2Jmd0OwogICZsdDsvZGl2Jmd0OwombHQ7L3RlbXBsYXRlJmd0OwoKJmx0O3N0eWxlIHNjb3BlZCZndDsKLmgxIHsKICBmb250LXNpemU6IDJyZW07CiAgZm9udC13ZWlnaHQ6IDgwMDsKICBsZXR0ZXItc3BhY2luZzogMC4wM2VtOwogIG1hcmdpbi1ib3R0b206IDJyZW07Cn0KLmgyIHsKICBmb250LXdlaWdodDogODAwOwogIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgbGV0dGVyLXNwYWNpbmc6IDAuMDVlbTsKICBtYXJnaW4tYm90dG9tOiAwLjVyZW07CiAgbWFyZ2luLXRvcDogMnJlbTsKfQouc3VidGl0bGUgewogIGNvbG9yOiByZ2JhKDAsIDAsIDAsIDAuNSk7CiAgZm9udC1zaXplOiAwLjg1cmVtOwp9CiZsdDsvc3R5bGUmZ3Q7Cg=="}}),e._v(" "),a("p",[e._v("In between "),a("code",[e._v("<script><\/script>")]),e._v(" tags below this")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZXhwb3J0IGRlZmF1bHQgewogIHByb3BzOiB7CiAgICB0eXBlOiB7CiAgICAgIGRlZmF1bHQ6ICZxdW90O3AxJnF1b3Q7LAogICAgfSwKICB9LAp9Owo="}}),e._v(" "),a("p",[e._v("Now in our "),a("code",[e._v("App.vue")]),e._v(" we need to update to fetch our votes. In the "),a("code",[e._v("<script><\/script>")]),e._v(" tag we should have the following resulting code:")]),e._v(" "),a("h3",{attrs:{id:"vue-src-app-vue-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vue-src-app-vue-2"}},[e._v("#")]),e._v(" "),a("code",[e._v("vue/src/App.vue")])]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"js",base64:"ZXhwb3J0IGRlZmF1bHQgewogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgmcXVvdDtjb3Ntb3MvaW5pdCZxdW90Oyk7CiAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgmcXVvdDtjb3Ntb3MvZW50aXR5RmV0Y2gmcXVvdDssIHt0eXBlOiAmcXVvdDtwb2xsJnF1b3Q7LCBtb2R1bGU6ICZxdW90O3ZvdGVyJnF1b3Q7fSk7CiAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgmcXVvdDtjb3Ntb3MvZW50aXR5RmV0Y2gmcXVvdDssIHt0eXBlOiAmcXVvdDt2b3RlJnF1b3Q7LCBtb2R1bGU6ICZxdW90O3ZvdGVyJnF1b3Q7fSk7CiAgfSwKfTsK"}}),e._v(" "),a("p",[e._v("By now should be able to see the same UI as in the first screenshot. Try creating polls and casting votes. You may notice that it's possible to cast multiple votes for one poll. This is not what we want, so let's fix this behaviour.")]),e._v(" "),a("h2",{attrs:{id:"casting-votes-only-once"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#casting-votes-only-once"}},[e._v("#")]),e._v(" Casting votes only once")]),e._v(" "),a("p",[e._v("To fix this issue we first have to understand how data is stored in our application.")]),e._v(" "),a("p",[e._v("We can think of our data storage as a lexicographically ordered key value store. You can loop through the entries, filter by key prefix, add, update and delete entries. It is easier to visualize the store as JSON:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ewogICZxdW90O3BvbGwtMWEyNjYyNDEtYzU4ZC00Y2JjLWJhY2YtYWFmOTM5Yzk1ZGUxJnF1b3Q7OiB7CiAgICAmcXVvdDtjcmVhdG9yJnF1b3Q7OiAmcXVvdDtjb3Ntb3MxNWM2ZzR2NXl2cTBoeTNramxseXI5eXRseDQ1cjkzNnkwbTZkbTYmcXVvdDssCiAgICAmcXVvdDtpZCZxdW90OzogJnF1b3Q7MWEyNjYyNDEtYzU4ZC00Y2JjLWJhY2YtYWFmOTM5Yzk1ZGUxJnF1b3Q7LAogICAgJnF1b3Q7dGl0bGUmcXVvdDs6ICZxdW90O1NvZnQgZHJpbmtzJnF1b3Q7LAogICAgJnF1b3Q7b3B0aW9ucyZxdW90OzogWyZxdW90O0NvY2EtQ29sYSZxdW90OywgJnF1b3Q7UGVwc2kmcXVvdDtdCiAgfSwKICAmcXVvdDt2b3RlLWNkNjNiMTEwLTI5NTktNDViMC04Y2UzLWFmYTJmYjdhNTY1MiZxdW90OzogewogICAgJnF1b3Q7Y3JlYXRvciZxdW90OzogJnF1b3Q7Y29zbW9zMTVjNmc0djV5dnEwaHkza2psbHlyOXl0bHg0NXI5MzZ5MG02ZG02JnF1b3Q7LAogICAgJnF1b3Q7aWQmcXVvdDs6ICZxdW90O2NkNjNiMTEwLTI5NTktNDViMC04Y2UzLWFmYTJmYjdhNTY1MiZxdW90OywKICAgICZxdW90O3BvbGxJRCZxdW90OzogJnF1b3Q7MWEyNjYyNDEtYzU4ZC00Y2JjLWJhY2YtYWFmOTM5Yzk1ZGUxJnF1b3Q7LAogICAgJnF1b3Q7dmFsdWUmcXVvdDs6ICZxdW90O1BlcHNpJnF1b3Q7CiAgfQp9Cg=="}}),e._v(" "),a("p",[e._v("Both "),a("code",[e._v("poll-")]),e._v(" and "),a("code",[e._v("vote-")]),e._v(" are prefixes. They are added to keys for ease of filtering. By convention, prefixes are defined in "),a("code",[e._v("x/voter/types/key.go")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"x-voter-keeper-vote-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-keeper-vote-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/keeper/vote.go")])]),e._v(" "),a("p",[e._v('Whenever a user casts a vote, a new "create vote" message is handled by a handler and is passed to a keeper. Keeper takes a '),a("code",[e._v("vote-")]),e._v(" prefix, adds a UUID (unique to every message) and uses this string as a key. "),a("code",[e._v("x/voter/keeper/vote.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"a2V5IDo9IFtdYnl0ZSh0eXBlcy5Wb3RlUHJlZml4ICsgdm90ZS5JRCkK"}}),e._v(" "),a("p",[e._v("These strings are unique and we get duplicate votes. To fix that we need to make sure a keeper records every vote only once by choosing the right key. In our case, we can use poll ID and creator address to make sure that one user can cast only one vote per poll.")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"a2V5IDo9IFtdYnl0ZSh0eXBlcy5Wb3RlUHJlZml4ICsgdm90ZS5Qb2xsSUQgKyAmcXVvdDstJnF1b3Q7ICsgc3RyaW5nKHZvdGUuQ3JlYXRvcikpCg=="}}),e._v(" "),a("p",[e._v("Restart the application and try voting multiple times on a single poll, you'll see you can vote as many times as you want but only your most recent vote is counted.")]),e._v(" "),a("h2",{attrs:{id:"introducing-a-fee-for-creating-polls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introducing-a-fee-for-creating-polls"}},[e._v("#")]),e._v(" Introducing a fee for creating polls")]),e._v(" "),a("p",[e._v("Let's make it so that creating a poll costs 200 tokens.")]),e._v(" "),a("p",[e._v("This feature is very easy to add. We already require users to have accounts registered, and each user has tokens on balance. The only thing we need to do is to send coins from user's account to a module account before we create a poll.")]),e._v(" "),a("h2",{attrs:{id:"x-voter-handlermsgcreatepoll-go"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#x-voter-handlermsgcreatepoll-go"}},[e._v("#")]),e._v(" "),a("code",[e._v("x/voter/handlerMsgCreatePoll.go")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB2b3RlcgoKaW1wb3J0ICgKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CgoJJnF1b3Q7Z2l0aHViLmNvbS9hbGljZS92b3Rlci94L3ZvdGVyL2tlZXBlciZxdW90OwoJJnF1b3Q7Z2l0aHViLmNvbS9hbGljZS92b3Rlci94L3ZvdGVyL3R5cGVzJnF1b3Q7CgkmcXVvdDtnaXRodWIuY29tL3RlbmRlcm1pbnQvdGVuZGVybWludC9jcnlwdG8mcXVvdDsKKQoKZnVuYyBoYW5kbGVNc2dDcmVhdGVQb2xsKGN0eCBzZGsuQ29udGV4dCwgayBrZWVwZXIuS2VlcGVyLCBtc2cgdHlwZXMuTXNnQ3JlYXRlUG9sbCkgKCpzZGsuUmVzdWx0LCBlcnJvcikgewoJdmFyIHBvbGwgPSB0eXBlcy5Qb2xsewoJCUNyZWF0b3I6IG1zZy5DcmVhdG9yLAoJCVRpdGxlOiAgIG1zZy5UaXRsZSwKCQlPcHRpb25zOiBtc2cuT3B0aW9ucywKCX0KCW1vZHVsZUFjY3QgOj0gc2RrLkFjY0FkZHJlc3MoY3J5cHRvLkFkZHJlc3NIYXNoKFtdYnl0ZSh0eXBlcy5Nb2R1bGVOYW1lKSkpCglwYXltZW50LCBfIDo9IHNkay5QYXJzZUNvaW5zKCZxdW90OzIwMHRva2VuJnF1b3Q7KQoJaWYgZXJyIDo9IGsuQ29pbktlZXBlci5TZW5kQ29pbnMoY3R4LCBwb2xsLkNyZWF0b3IsIG1vZHVsZUFjY3QsIHBheW1lbnQpOyBlcnIgIT0gbmlsIHsKCQlyZXR1cm4gbmlsLCBlcnIKCX0KCWsuQ3JlYXRlUG9sbChjdHgsIG1zZykKCglyZXR1cm4gJmFtcDtzZGsuUmVzdWx0e0V2ZW50czogY3R4LkV2ZW50TWFuYWdlcigpLkV2ZW50cygpfSwgbmlsCn0K"}}),e._v(" "),a("p",[e._v("The fee payment happens before "),a("code",[e._v("k.CreatePoll(ctx, poll)")]),e._v(". This way, if a user does not have enough tokens, the application will raise an error and will not proceed to creating a poll. Make sure to have "),a("code",[e._v('"github.com/tendermint/tendermint/crypto"')]),e._v(" added to the import statement (if your text editor didn't do that for you).")]),e._v(" "),a("p",[e._v("Now, restart the app and try creating several polls to see how this affects your token balance.")]),e._v(" "),a("p",[e._v("Congratulations, you have built a blockchain voting application.")])],1)}),[],!1,null,null,null);t.default=s.exports}}]);