(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{737:function(e,a,c){"use strict";c.r(a);var t=c(0),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,c=e._self._c||a;return c("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[c("h2",{attrs:{id:"channels"}},[c("a",{staticClass:"header-anchor",attrs:{href:"#channels"}},[e._v("#")]),e._v(" Channels")]),e._v(" "),c("p",[e._v("After a connection is established, an application needs to bind to a port and a channel. It is important to understand what a channel is before diving further.")]),e._v(" "),c("p",[e._v("A channel serves as a "),c("strong",[e._v("conduit for packets")]),e._v(" passing between a module on one chain and a module on another one to ensure that packets are executed only once, they are delivered in the order in which they were sent (if necessary), and they are delivered only to the corresponding module owning the other end of the channel on the destination chain. Each channel is associated with a particular connection. A connection may have any number of associated channels, allowing the use of common identifiers and amortizing the cost of header verification across all the channels utilizing a connection and a light client.")]),e._v(" "),c("p",[e._v("Channels are payload agnostic: the modules sending and receiving IBC packets decide how to construct packet data and how to act upon the incoming packet data, and must use their own application logic to determine which state transactions to apply according to what data the packet contains.")]),e._v(" "),c("p",[e._v("An "),c("strong",[e._v("ordered channel")]),e._v(" is "),c("em",[e._v("a channel where packets are delivered exactly in the order in which they were sent")]),e._v(".\nAn "),c("strong",[e._v("unordered channel")]),e._v(" is "),c("em",[e._v("a channel where packets can be delivered in any order")]),e._v(", which may differ from the order in which they were sent.")]),e._v(" "),c("p",[c("tm-image",{attrs:{src:"/academy/ibc/images/channelhandshake.png"}})],1),e._v(" "),c("p",[e._v("You can see that an IBC channel handshake is smiliar to a connection handshake:")]),e._v(" "),c("ol",[c("li",[c("code",[e._v("ChanOpenInit")]),e._v(": sets chain A into "),c("code",[e._v("INIT")]),e._v(" state. This calls "),c("code",[e._v("OnChanOpenInit")]),e._v(" so application A can apply its "),c("code",[e._v("INIT")]),e._v("logic (e.g. check if the port is set correctly).")]),e._v(" "),c("li",[c("code",[e._v("ChanOpenTry")]),e._v(": sets chain B into "),c("code",[e._v("TRY")]),e._v(" state. This calls "),c("code",[e._v("OnChanOpenConfirm")]),e._v(" so application B can apply its "),c("code",[e._v("TRY")]),e._v(" logic.")]),e._v(" "),c("li",[c("code",[e._v("ChanOpenAck")]),e._v(": sets chain A into "),c("code",[e._v("OPEN")]),e._v(" state. This calls "),c("code",[e._v("OnChanOpenAck")]),e._v(" which is implemented by the application.")]),e._v(" "),c("li",[c("code",[e._v("ChanOpenConfirm")]),e._v(": sets chain B into "),c("code",[e._v("OPEN")]),e._v(" state, so application B can apply its "),c("code",[e._v("CONFIRM")]),e._v(" logic.")])]),e._v(" "),c("p",[e._v("If an application returns an error during this process, the handshake will fail.")]),e._v(" "),c("p",[e._v("Note that if you use a channel between two applications, you have to trust that the applications on both ends are not malicious.")]),e._v(" "),c("p",[e._v("You can find the implementation of "),c("code",[e._v("ChannelOpenInit")]),e._v(" in the "),c("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/keeper/msg_server.go",target:"_blank",rel:"noopener noreferrer"}},[c("code",[e._v("msg_server.go")]),c("OutboundLink")],1),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gQ2hhbm5lbE9wZW5Jbml0IGRlZmluZXMgYSBycGMgaGFuZGxlciBtZXRob2QgZm9yIE1zZ0NoYW5uZWxPcGVuSW5pdC4KLy8gQ2hhbm5lbE9wZW5Jbml0IHdpbGwgcGVyZm9ybSAwNC1jaGFubmVsIGNoZWNrcywgcm91dGUgdG8gdGhlIGFwcGxpY2F0aW9uCi8vIGNhbGxiYWNrLCBhbmQgd3JpdGUgYW4gT3BlbkluaXQgY2hhbm5lbCBpbnRvIHN0YXRlIHVwb24gc3VjY2Vzc2Z1bCBleGVjdXRpb24uCmZ1bmMgKGsgS2VlcGVyKSBDaGFubmVsT3BlbkluaXQoZ29DdHggY29udGV4dC5Db250ZXh0LCBtc2cgKmNoYW5uZWx0eXBlcy5Nc2dDaGFubmVsT3BlbkluaXQpICgqY2hhbm5lbHR5cGVzLk1zZ0NoYW5uZWxPcGVuSW5pdFJlc3BvbnNlLCBlcnJvcikgewogIGN0eCA6PSBzZGsuVW53cmFwU0RLQ29udGV4dChnb0N0eCkKCiAgLy8gTG9va3VwIG1vZHVsZSBieSBwb3J0IGNhcGFiaWxpdHkKICBtb2R1bGUsIHBvcnRDYXAsIGVyciA6PSBrLlBvcnRLZWVwZXIuTG9va3VwTW9kdWxlQnlQb3J0KGN0eCwgbXNnLlBvcnRJZCkKICBpZiBlcnIgIT0gbmlsIHsKICAgIHJldHVybiBuaWwsIHNka2Vycm9ycy5XcmFwKGVyciwgJnF1b3Q7Y291bGQgbm90IHJldHJpZXZlIG1vZHVsZSBmcm9tIHBvcnQtaWQmcXVvdDspCiAgfQoKICAuLi4KCiAgLy8gUGVyZm9ybSAwNC1jaGFubmVsIHZlcmlmaWNhdGlvbgogIGNoYW5uZWxJRCwgY2FwLCBlcnIgOj0gay5DaGFubmVsS2VlcGVyLkNoYW5PcGVuSW5pdCgKICAgIGN0eCwgbXNnLkNoYW5uZWwuT3JkZXJpbmcsIG1zZy5DaGFubmVsLkNvbm5lY3Rpb25Ib3BzLCBtc2cuUG9ydElkLAogICAgcG9ydENhcCwgbXNnLkNoYW5uZWwuQ291bnRlcnBhcnR5LCBtc2cuQ2hhbm5lbC5WZXJzaW9uLAogICkKCiAgLi4uCgogIC8vIFBlcmZvcm0gYXBwbGljYXRpb24gbG9naWMgY2FsbGJhY2sKICBpZiBlcnIgPSBjYnMuT25DaGFuT3BlbkluaXQoY3R4LCBtc2cuQ2hhbm5lbC5PcmRlcmluZywgbXNnLkNoYW5uZWwuQ29ubmVjdGlvbkhvcHMsIG1zZy5Qb3J0SWQsIGNoYW5uZWxJRCwgY2FwLCBtc2cuQ2hhbm5lbC5Db3VudGVycGFydHksIG1zZy5DaGFubmVsLlZlcnNpb24pOyBlcnIgIT0gbmlsIHsKICAgIHJldHVybiBuaWwsIHNka2Vycm9ycy5XcmFwKGVyciwgJnF1b3Q7Y2hhbm5lbCBvcGVuIGluaXQgY2FsbGJhY2sgZmFpbGVkJnF1b3Q7KQogIH0KCiAgLy8gV3JpdGUgY2hhbm5lbCBpbnRvIHN0YXRlCiAgay5DaGFubmVsS2VlcGVyLldyaXRlT3BlbkluaXRDaGFubmVsKGN0eCwgbXNnLlBvcnRJZCwgY2hhbm5lbElELCBtc2cuQ2hhbm5lbC5PcmRlcmluZywgbXNnLkNoYW5uZWwuQ29ubmVjdGlvbkhvcHMsIG1zZy5DaGFubmVsLkNvdW50ZXJwYXJ0eSwgbXNnLkNoYW5uZWwuVmVyc2lvbikKCiAgcmV0dXJuICZhbXA7Y2hhbm5lbHR5cGVzLk1zZ0NoYW5uZWxPcGVuSW5pdFJlc3BvbnNlewogICAgQ2hhbm5lbElkOiBjaGFubmVsSUQsCiAgfSwgbmlsCn0K"}}),e._v(" "),c("p",[e._v("After verification of the module capability, the first step of the channel handshake will take place and "),c("code",[e._v("ChanOpenInit")]),e._v(" will be called as described previously. Note that an application has capabilities for different channels and ports, and can only use a specific channel and port if it owns the capability for them.")]),e._v(" "),c("HighlightBox",{attrs:{type:"info"}},[c("p",[e._v("IBC is intended to work in execution environments where modules do not necessarily trust each other. IBC must authenticate module actions on ports and channels so that only modules with the appropriate permissions can use those channels. This security is accomplished using dynamic capabilities. Upon binding to a port or creating a channel for a module, IBC returns a dynamic capability that the module must claim to use that port or channel. This binding strategy prevents another module from using that port or channel since it does not own the appropriate capability.\n")])]),c("p"),e._v(" "),c("p",[e._v("You can see that the application callbacks come from a "),c("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/05-port/types/router.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("router"),c("OutboundLink")],1),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gR2V0Um91dGUgcmV0dXJucyBhIElCQ01vZHVsZSBmb3IgYSBnaXZlbiBtb2R1bGUuCmZ1bmMgKHJ0ciAqUm91dGVyKSBHZXRSb3V0ZShtb2R1bGUgc3RyaW5nKSAoSUJDTW9kdWxlLCBib29sKSB7CiAgaWYgIXJ0ci5IYXNSb3V0ZShtb2R1bGUpIHsKICAgIHJldHVybiBuaWwsIGZhbHNlCiAgfQogIHJldHVybiBydHIucm91dGVzW21vZHVsZV0sIHRydWUKfQo="}}),e._v(" "),c("p",[e._v("This returns an implementation of the "),c("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/05-port/types/module.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC Module Interface"),c("OutboundLink")],1),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gSUJDTW9kdWxlIGRlZmluZXMgYW4gaW50ZXJmYWNlIHRoYXQgaW1wbGVtZW50cyBhbGwgdGhlIGNhbGxiYWNrcwovLyB0aGF0IG1vZHVsZXMgbXVzdCBkZWZpbmUgYXMgc3BlY2lmaWVkIGluIElDUy0yNgp0eXBlIElCQ01vZHVsZSBpbnRlcmZhY2UgewogIC8vIE9uQ2hhbk9wZW5Jbml0IHdpbGwgdmVyaWZ5IHRoYXQgdGhlIHJlbGF5ZXItY2hvc2VuIHBhcmFtZXRlcnMgYXJlCiAgLy8gdmFsaWQgYW5kIHBlcmZvcm0gYW55IGN1c3RvbSBJTklUIGxvZ2ljLkl0IG1heSByZXR1cm4gYW4gZXJyb3IgaWYKICAvLyB0aGUgY2hvc2VuIHBhcmFtZXRlcnMgYXJlIGludmFsaWQgaW4gd2hpY2ggY2FzZSB0aGUgaGFuZHNoYWtlIGlzIGFib3J0ZWQuCiAgLy8gT25DaGFuT3BlbkluaXQgc2hvdWxkIHJldHVybiBhbiBlcnJvciBpZiB0aGUgcHJvdmlkZWQgdmVyc2lvbiBpcyBpbnZhbGlkLgogIE9uQ2hhbk9wZW5Jbml0KAogICAgY3R4IHNkay5Db250ZXh0LAogICAgb3JkZXIgY2hhbm5lbHR5cGVzLk9yZGVyLAogICAgY29ubmVjdGlvbkhvcHMgW11zdHJpbmcsCiAgICBwb3J0SUQgc3RyaW5nLAogICAgY2hhbm5lbElEIHN0cmluZywKICAgIGNoYW5uZWxDYXAgKmNhcGFiaWxpdHl0eXBlcy5DYXBhYmlsaXR5LAogICAgY291bnRlcnBhcnR5IGNoYW5uZWx0eXBlcy5Db3VudGVycGFydHksCiAgICB2ZXJzaW9uIHN0cmluZywKICApIGVycm9yCgo="}}),e._v(" "),c("p",[e._v("Here you find all the callbacks your application will need to implement. For example, in the "),c("code",[e._v("msg_serve.go")]),e._v(" you find the following in the "),c("code",[e._v("ChannelOpenInit")]),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ICAvLyBQZXJmb3JtIGFwcGxpY2F0aW9uIGxvZ2ljIGNhbGxiYWNrCiAgaWYgZXJyID0gY2JzLk9uQ2hhbk9wZW5Jbml0KGN0eCwgbXNnLkNoYW5uZWwuT3JkZXJpbmcsIG1zZy5DaGFubmVsLkNvbm5lY3Rpb25Ib3BzLCBtc2cuUG9ydElkLCBjaGFubmVsSUQsIGNhcCwgbXNnLkNoYW5uZWwuQ291bnRlcnBhcnR5LCBtc2cuQ2hhbm5lbC5WZXJzaW9uKTsgZXJyICE9IG5pbCB7CiAgICByZXR1cm4gbmlsLCBzZGtlcnJvcnMuV3JhcChlcnIsICZxdW90O2NoYW5uZWwgb3BlbiBpbml0IGNhbGxiYWNrIGZhaWxlZCZxdW90OykKICB9Cg=="}}),e._v(" "),c("p",[e._v("This calls the custom logic of the application. The situation is similar for "),c("code",[e._v("OnChanOpenTry")]),e._v(", "),c("code",[e._v("OnChanOpenAck")]),e._v(", "),c("code",[e._v("OnChanOpenConfirm")]),e._v(", and others in the "),c("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/05-port/types/module.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC Module Interface"),c("OutboundLink")],1),e._v(":")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ICAvLyBPbkNoYW5PcGVuVHJ5IHdpbGwgdmVyaWZ5IHRoZSByZWxheWVyLWNob3NlbiBwYXJhbWV0ZXJzIGFsb25nIHdpdGggdGhlCiAgLy8gY291bnRlcnBhcnR5LWNob3NlbiB2ZXJzaW9uIHN0cmluZyBhbmQgcGVyZm9ybSBjdXN0b20gVFJZIGxvZ2ljLgogIC8vIElmIHRoZSByZWxheWVyLWNob3NlbiBwYXJhbWV0ZXJzIGFyZSBpbnZhbGlkLCB0aGUgY2FsbGJhY2sgbXVzdCByZXR1cm4KICAvLyBhbiBlcnJvciB0byBhYm9ydCB0aGUgaGFuZHNoYWtlLiBJZiB0aGUgY291bnRlcnBhcnR5LWNob3NlbiB2ZXJzaW9uIGlzIG5vdAogIC8vIGNvbXBhdGlibGUgd2l0aCB0aGlzIG1vZHVsZXMgc3VwcG9ydGVkIHZlcnNpb25zLCB0aGUgY2FsbGJhY2sgbXVzdCByZXR1cm4KICAvLyBhbiBlcnJvciB0byBhYm9ydCB0aGUgaGFuZHNoYWtlLiBJZiB0aGUgdmVyc2lvbnMgYXJlIGNvbXBhdGlibGUsIHRoZSB0cnkgY2FsbGJhY2sKICAvLyBtdXN0IHNlbGVjdCB0aGUgZmluYWwgdmVyc2lvbiBzdHJpbmcgYW5kIHJldHVybiBpdCB0byBjb3JlIElCQy4KICAvLyBPbkNoYW5PcGVuVHJ5IG1heSBhbHNvIHBlcmZvcm0gY3VzdG9tIGluaXRpYWxpemF0aW9uIGxvZ2ljCiAgT25DaGFuT3BlblRyeSgKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIG9yZGVyIGNoYW5uZWx0eXBlcy5PcmRlciwKICAgIGNvbm5lY3Rpb25Ib3BzIFtdc3RyaW5nLAogICAgcG9ydElELAogICAgY2hhbm5lbElEIHN0cmluZywKICAgIGNoYW5uZWxDYXAgKmNhcGFiaWxpdHl0eXBlcy5DYXBhYmlsaXR5LAogICAgY291bnRlcnBhcnR5IGNoYW5uZWx0eXBlcy5Db3VudGVycGFydHksCiAgICBjb3VudGVycGFydHlWZXJzaW9uIHN0cmluZywKICApICh2ZXJzaW9uIHN0cmluZywgZXJyIGVycm9yKQoKICAvLyBPbkNoYW5PcGVuQWNrIHdpbGwgZXJyb3IgaWYgdGhlIGNvdW50ZXJwYXJ0eSBzZWxlY3RlZCB2ZXJzaW9uIHN0cmluZwogIC8vIGlzIGludmFsaWQgdG8gYWJvcnQgdGhlIGhhbmRzaGFrZS4gSXQgbWF5IGFsc28gcGVyZm9ybSBjdXN0b20gQUNLIGxvZ2ljLgogIE9uQ2hhbk9wZW5BY2soCiAgICBjdHggc2RrLkNvbnRleHQsCiAgICBwb3J0SUQsCiAgICBjaGFubmVsSUQgc3RyaW5nLAogICAgY291bnRlcnBhcnR5Q2hhbm5lbElEIHN0cmluZywKICAgIGNvdW50ZXJwYXJ0eVZlcnNpb24gc3RyaW5nLAogICkgZXJyb3IKCiAgLy8gT25DaGFuT3BlbkNvbmZpcm0gd2lsbCBwZXJmb3JtIGN1c3RvbSBDT05GSVJNIGxvZ2ljIGFuZCBtYXkgZXJyb3IgdG8gYWJvcnQgdGhlIGhhbmRzaGFrZS4KICBPbkNoYW5PcGVuQ29uZmlybSgKICAgIGN0eCBzZGsuQ29udGV4dCwKICAgIHBvcnRJRCwKICAgIGNoYW5uZWxJRCBzdHJpbmcsCiAgKSBlcnJvcgoKLi4uCg=="}}),e._v(" "),c("p",[e._v("Applications will be discussed soon, but the important point here is that an application developer will need to implement the "),c("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/05-port/types/module.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC Module Interface"),c("OutboundLink")],1),e._v(".")]),e._v(" "),c("p",[e._v("Modules communicate with each other by sending packets over IBC channels. Look at the "),c("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/04-channel/types/packet.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("packet definition"),c("OutboundLink")],1),e._v(" to see the packet structure:")]),e._v(" "),c("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gTmV3UGFja2V0IGNyZWF0ZXMgYSBuZXcgUGFja2V0IGluc3RhbmNlLiBJdCBwYW5pY3MgaWYgdGhlIHByb3ZpZGVkCi8vIHBhY2tldCBkYXRhIGludGVyZmFjZSBpcyBub3QgcmVnaXN0ZXJlZC4KZnVuYyBOZXdQYWNrZXQoCiAgZGF0YSBbXWJ5dGUsCiAgc2VxdWVuY2UgdWludDY0LCBzb3VyY2VQb3J0LCBzb3VyY2VDaGFubmVsLAogIGRlc3RpbmF0aW9uUG9ydCwgZGVzdGluYXRpb25DaGFubmVsIHN0cmluZywKICB0aW1lb3V0SGVpZ2h0IGNsaWVudHR5cGVzLkhlaWdodCwgdGltZW91dFRpbWVzdGFtcCB1aW50NjQsCikgUGFja2V0IHsKICByZXR1cm4gUGFja2V0ewogICAgRGF0YTogICAgICAgICAgICAgICBkYXRhLAogICAgU2VxdWVuY2U6ICAgICAgICAgICBzZXF1ZW5jZSwKICAgIFNvdXJjZVBvcnQ6ICAgICAgICAgc291cmNlUG9ydCwKICAgIFNvdXJjZUNoYW5uZWw6ICAgICAgc291cmNlQ2hhbm5lbCwKICAgIERlc3RpbmF0aW9uUG9ydDogICAgZGVzdGluYXRpb25Qb3J0LAogICAgRGVzdGluYXRpb25DaGFubmVsOiBkZXN0aW5hdGlvbkNoYW5uZWwsCiAgICBUaW1lb3V0SGVpZ2h0OiAgICAgIHRpbWVvdXRIZWlnaHQsCiAgICBUaW1lb3V0VGltZXN0YW1wOiAgIHRpbWVvdXRUaW1lc3RhbXAsCiAgfQp9Cg=="}}),e._v(" "),c("p",[c("code",[e._v("Sequence")]),e._v(" will determine if packet delivery is ordered. "),c("code",[e._v("TimeoutTimestamp")]),e._v(" and "),c("code",[e._v("TimeoutHeight")]),e._v(" determine the deadline before which the receiving module must process a packet. If the timeout passes without the packet being successfully received, the sending module can timeout the packet and take appropriate actions.")]),e._v(" "),c("p",[c("tm-image",{attrs:{src:"/academy/ibc/images/packetflow.png"}})],1),e._v(" "),c("p",[e._v("The previous diagram show successful and unsuccessful packet flows:")]),e._v(" "),c("ol",[c("li",[c("strong",[e._v("Successful:")]),e._v(" Application A sends a packet (call "),c("code",[e._v("sendPacket")]),e._v(") to application B. This can be triggerd by a user, but applications can also act without a user. Core IBC A commits the packet to its own state, and the relayer can query this packet and send a receive message to Core IBC B. Verifications are done by Core IBC B and application B gets the packet if it is valid. Note that the applications on both ends need to marshal and unmarshal the data. Application B then sends an acknowledgment message to Core IBC B, which again commits it to its own state so it can be sent by a relayer to Core IBC A.")]),e._v(" "),c("li",[c("strong",[e._v("Unsuccessful:")]),e._v(" In second scenario, the packet is not received in time. In this case, Core IBC A receives a "),c("code",[e._v("TimeoutPacket")]),e._v(" message from the relayer and calls "),c("code",[e._v("OnTimeoutPacket")]),e._v(" on application A.")])])],1)}),[],!1,null,null,null);a.default=n.exports}}]);