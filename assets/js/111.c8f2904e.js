(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{812:function(t,a,e){"use strict";e.r(a);var s=e(1),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"a-game-deadline"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-game-deadline"}},[t._v("#")]),t._v(" A Game Deadline")]),t._v(" "),e("HighlightBox",{attrs:{type:"synopsis"}},[e("p",[t._v("Make sure you have all you need before proceeding:")]),t._v(" "),e("ul",[e("li",[t._v("You understand the concepts of "),e("RouterLink",{attrs:{to:"/academy/2-main-concepts/protobuf.html"}},[t._v("Protobuf")]),t._v(".")],1),t._v(" "),e("li",[t._v("Have Go installed.")]),t._v(" "),e("li",[t._v("The checkers blockchain codebase with the game FIFO. You can get there by following the "),e("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[t._v("previous steps")]),t._v(" or checking out the "),e("a",{attrs:{href:"https://github.com/cosmos/b9-checkers-academy-draft/tree/game-fifo",target:"_blank",rel:"noopener noreferrer"}},[t._v("relevant version"),e("OutboundLink")],1),t._v(".")],1)])]),t._v(" "),e("p",[t._v("In the "),e("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[t._v("previous section")]),t._v(" you introduced a FIFO that keeps the "),e("em",[t._v("oldest")]),t._v(" games at its head and the most recently updated games at its tail.")],1),t._v(" "),e("p",[t._v("Just because a game has not been updated in a while does not mean that it has expired. To ascertain this you need to add a new field, "),e("code",[t._v("deadline")]),t._v(", to a game and test against it. Time to prepare the field.")]),t._v(" "),e("h2",{attrs:{id:"new-information"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#new-information"}},[t._v("#")]),t._v(" New information")]),t._v(" "),e("p",[t._v("To prepare the field, add in the "),e("code",[t._v("StoredGame")]),t._v("'s Protobuf definition:")]),t._v(" "),e("div",{staticClass:"language-protobuf [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/proto/checkers/stored_game.proto#L18] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StoredGame")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" deadline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("To have Starport and Protobuf recompile this file. You can use:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ starport generate proto-go\n")])])]),e("p",[t._v("On each update the deadline will always be "),e("em",[t._v("now")]),t._v(" plus a fixed duration. In this context, "),e("em",[t._v("now")]),t._v(" refers to the block's time. Declare this duration as a new constant, along with how the date is to be represented, i.e. encoded in the saved game as a string:")]),t._v(" "),e("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/keys.go#L38-L39] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    MaxTurnDurationInSeconds "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Duration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("_600 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("_000_000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1 day")]),t._v("\n    DeadlineLayout           "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2006-01-02 15:04:05.999999999 +0000 UTC"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"date-manipulation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#date-manipulation"}},[t._v("#")]),t._v(" Date manipulation")]),t._v(" "),e("p",[t._v("You can make your life easier by using helper functions that encode and decode the deadline in the storage.")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("First define a new error:")]),t._v(" "),e("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/errors.go#L21] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[t._v("ErrInvalidDeadline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sdkerrors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Register")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ModuleName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1110")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"deadline cannot be parsed: %s"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Now you can add your date helpers. A reasonable location to pick is "),e("code",[t._v("full_game.go")]),t._v(":")]),t._v(" "),e("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/full_game.go#L37-L48] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("storedGame "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("StoredGame"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetDeadlineAsTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    deadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" errDeadline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Parse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DeadlineLayout"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" storedGame"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Deadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" deadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sdkerrors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Wrapf")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("errDeadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ErrInvalidDeadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" storedGame"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Deadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("FormatDeadline")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" deadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("UTC")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Format")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DeadlineLayout"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Of note in the above is that "),e("code",[t._v("sdkerrors.Wrapf(err, ...)")]),t._v(" returns "),e("code",[t._v("nil")]),t._v(" if "),e("code",[t._v("err")]),t._v(" is "),e("code",[t._v("nil")]),t._v(". This is very convenient.")])]),t._v(" "),e("li",[e("p",[t._v("Add a function that encapsulates the knowledge of how the next deadline is calculated in the same file:")]),t._v(" "),e("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/types/full_game.go#L42-L44] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetNextDeadline")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx sdk"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" time"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Time "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("BlockTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MaxTurnDurationInSeconds"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),e("h2",{attrs:{id:"updated-deadline"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#updated-deadline"}},[t._v("#")]),t._v(" Updated deadline")]),t._v(" "),e("p",[t._v("Next you need to update this new field with its appropriate value:")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("At creation in the message handler for game creation:")]),t._v(" "),e("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/keeper/msg_server_create_game.go#L26] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\nstoredGame "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StoredGame"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    Deadline"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("FormatDeadline")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetNextDeadline")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("And after a move in the message handler:")]),t._v(" "),e("div",{staticClass:"language-go [https://github.com/cosmos/b9-checkers-academy-draft/blob/0d0e36a8ac86cddc457610856ddaab1b356cee84/x/checkers/keeper/msg_server_play_move.go#L56] extra-class"},[e("pre",{pre:!0,attrs:{class:"language-go"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\nstoredGame"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MoveCount"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\nstoredGame"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Deadline "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("FormatDeadline")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("types"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetNextDeadline")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("Now confirm that your project still compiles:")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("$ starport chain build\n")])])]),e("p",[t._v("You have created and updated the deadline. The "),e("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-forfeit.html"}},[t._v("section two steps ahead")]),t._v(" describes how to use the deadline and "),e("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-fifo.html"}},[t._v("the FIFO")]),t._v(" to expire games that reached their deadline.")],1),t._v(" "),e("p",[t._v("Before you can do that there is one other field you need to add. Discover which in the "),e("RouterLink",{attrs:{to:"/academy/4-my-own-chain/game-winner.html"}},[t._v("next section")]),t._v(".")],1)],1)}),[],!1,null,null,null);a.default=n.exports}}]);