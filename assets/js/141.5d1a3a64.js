(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{744:function(e,n,a){"use strict";a.r(n);var t=a(0),o=Object(t.a)({},(function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"ibc-fungible-token-transfer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ibc-fungible-token-transfer"}},[e._v("#")]),e._v(" IBC Fungible Token Transfer")]),e._v(" "),a("HighlightBox",{attrs:{type:"learning"}},[a("p",[e._v("Transferring tokens between chains is both a common requirement and a significant technical challenge when two chains are incompatible, and as you might expect, a convenient solution for moving tokens between chains.")]),e._v(" "),a("p",[e._v("In this section, you will explore how a fungible token transfer can be done with IBC.")])]),e._v(" "),a("p",[e._v("Having looked at IBC's transport, authentication, and ordering layer (IBC/TAO), you can now take a look at "),a("a",{attrs:{href:"https://github.com/cosmos/ibc/blob/master/spec/app/ics-020-fungible-token-transfer/README.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("ICS-20"),a("OutboundLink")],1),e._v(". ICS-20 describes "),a("strong",[e._v("fungible token transfers")]),e._v(".")]),e._v(" "),a("HighlightBox",{attrs:{type:"info"}},[a("p",[e._v("Fungibility refers to an instance in which a token is interchangeable with other instances of that token or not. Fungible tokens can be exchanged and replaced.")])]),e._v(" "),a("p",[e._v("There are many use cases involving token transfers on blockchains, like the tokenization of assets holding value or initial coin offerings (ICOs) to finance blockchain projects. IBC makes it possible to transfer tokens/digital assets between (sovereign) chains, both fungible and non-fungible tokens. While fungible token transfers allow, for example, to build applications relying on cross-chain payments and token exchanges. Therefore, IBC frees up great potential for cross-chain Decentralized Finance (DeFi) applications by offering a technically reliable cross-chain interoperability protocol that is compatible with digital assets on multiple networks.")]),e._v(" "),a("p",[e._v("The corresponding "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/tree/main/modules/apps/transfer",target:"_blank",rel:"noopener noreferrer"}},[e._v("implementation"),a("OutboundLink")],1),e._v(" is a module on the application level.")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/ibc/images/transferoverview.png"}})],1),e._v(" "),a("p",[e._v("Look at the picture above. You can see three chains A, B, and C. You also see several channels.")]),e._v(" "),a("p",[e._v("How can tokens be transferred between chains and channels?")]),e._v(" "),a("p",[e._v("To understand the application logic for a token transfer, first, you have to determine the "),a("strong",[e._v("source")]),e._v(" chain:")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/ibc/images/sourcechain.png"}})],1),e._v(" "),a("p",[e._v("Then the application logic can be summarized:")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/ibc/images/applicationlogic.png"}})],1),e._v(" "),a("p",[e._v("Shortly you will see the corresponding code. Now again have a look at a transfer from "),a("strong",[e._v("source")]),e._v(" to "),a("strong",[e._v("sink")]),e._v(":")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/ibc/images/sourcetosink.png"}})],1),e._v(" "),a("p",[e._v("Above the "),a("strong",[e._v("source")]),e._v(" is chain A. The source channel is "),a("strong",[e._v("channel-2")]),e._v(" and the destination channel is "),a("strong",[e._v("channel-40")]),e._v(". The token denominations are represented as "),a("code",[e._v("{Port}/{Channel}/{denom}")]),e._v(". The prefixed port and channel pair indicate which channel the funds were previously sent through. You see "),a("strong",[e._v("transfer/channel-...")]),e._v(" because the transfer module will bind to a port, which is named transfer. If chain A sends 100 ATOM tokens, chain B will receive 100 ATOM tokens and append the destination prefix "),a("strong",[e._v("port/channel-id")]),e._v(". So chain B will mint those 100 ATOM tokens as "),a("strong",[e._v("transfer/channel-40/atoms")]),e._v(". The "),a("strong",[e._v("channel-id")]),e._v(" will be increased sequentially per channel on a given connection.")]),e._v(" "),a("p",[e._v("If the tokens are sent back from the "),a("strong",[e._v("same channel")]),e._v(" as they were received:")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/ibc/images/sinktosource.png"}})],1),e._v(" "),a("p",[e._v('Chain A will "un-escrow" 100 '),a("strong",[e._v("ATOM tokens")]),e._v(", thus, the prefix will be removed. Chain B will burn "),a("strong",[e._v("transfer/channel-40/atoms")]),e._v(".")]),e._v(" "),a("p",[a("strong",[e._v("Notice:")]),e._v(" the prefix determines the "),a("strong",[e._v("source")]),e._v(" chain. If the module sends the token from another channel, chain B is the source chain and chain A mints new tokens with a prefix instead of un-escrowing ATOM tokens. You can have different channels between two chains, but you cannot transfer the same token across different channels back and forth. If "),a("code",[e._v("{denom}")]),e._v(" contains "),a("code",[e._v("/")]),e._v(", then it must also follow the ICS-20 form, which indicates that this token has a multi-hop record. Note this requires that "),a("code",[e._v("/")]),e._v(" is prohibited in non-IBC token denomination names.")]),e._v(" "),a("p",[a("tm-image",{attrs:{src:"/academy/ibc/images/sourcesinklogic.png"}})],1),e._v(" "),a("p",[e._v("You already know that an application needs to implement the "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/core/05-port/types/module.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("IBC Module Interface"),a("OutboundLink")],1),e._v(", so have a look at the "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/apps/transfer/ibc_module.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("implementation for the token transfer"),a("OutboundLink")],1),e._v(", e.g. for "),a("code",[e._v("OnChanOpenInit")]),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25DaGFuT3BlbkluaXQgaW1wbGVtZW50cyB0aGUgSUJDTW9kdWxlIGludGVyZmFjZQpmdW5jIChpbSBJQkNNb2R1bGUpIE9uQ2hhbk9wZW5Jbml0KAogIGN0eCBzZGsuQ29udGV4dCwKICBvcmRlciBjaGFubmVsdHlwZXMuT3JkZXIsCiAgY29ubmVjdGlvbkhvcHMgW11zdHJpbmcsCiAgcG9ydElEIHN0cmluZywKICBjaGFubmVsSUQgc3RyaW5nLAogIGNoYW5DYXAgKmNhcGFiaWxpdHl0eXBlcy5DYXBhYmlsaXR5LAogIGNvdW50ZXJwYXJ0eSBjaGFubmVsdHlwZXMuQ291bnRlcnBhcnR5LAogIHZlcnNpb24gc3RyaW5nLAopIGVycm9yIHsKICBpZiBlcnIgOj0gVmFsaWRhdGVUcmFuc2ZlckNoYW5uZWxQYXJhbXMoY3R4LCBpbS5rZWVwZXIsIG9yZGVyLCBwb3J0SUQsIGNoYW5uZWxJRCk7IGVyciAhPSBuaWwgewogICAgcmV0dXJuIGVycgogIH0KCiAgaWYgdmVyc2lvbiAhPSB0eXBlcy5WZXJzaW9uIHsKICAgIHJldHVybiBzZGtlcnJvcnMuV3JhcGYodHlwZXMuRXJySW52YWxpZFZlcnNpb24sICZxdW90O2dvdCAlcywgZXhwZWN0ZWQgJXMmcXVvdDssIHZlcnNpb24sIHR5cGVzLlZlcnNpb24pCiAgfQoKICAvLyBDbGFpbSBjaGFubmVsIGNhcGFiaWxpdHkgcGFzc2VkIGJhY2sgYnkgSUJDIG1vZHVsZQogIGlmIGVyciA6PSBpbS5rZWVwZXIuQ2xhaW1DYXBhYmlsaXR5KGN0eCwgY2hhbkNhcCwgaG9zdC5DaGFubmVsQ2FwYWJpbGl0eVBhdGgocG9ydElELCBjaGFubmVsSUQpKTsgZXJyICE9IG5pbCB7CiAgICByZXR1cm4gZXJyCiAgfQoKICByZXR1cm4gbmlsCn0K"}}),e._v(" "),a("p",[a("code",[e._v("OnChanOpenAck")]),e._v(", "),a("code",[e._v("OnChanOpenConfirm")]),e._v(", "),a("code",[e._v("OnChanCloseInit")]),e._v(", and "),a("code",[e._v("OnChanCloseConfirm")]),e._v(" will do (almost) no checks.")]),e._v(" "),a("p",[e._v("After a channel is established, the module can start sending and receiving packets. "),a("code",[e._v("OnRecvPacket")]),e._v(" will decode a packet and apply the transfer token application logic:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gT25SZWN2UGFja2V0IGltcGxlbWVudHMgdGhlIElCQ01vZHVsZSBpbnRlcmZhY2UuIEEgc3VjY2Vzc2Z1bCBhY2tub3dsZWRnZW1lbnQKLy8gaXMgcmV0dXJuZWQgaWYgdGhlIHBhY2tldCBkYXRhIGlzIHN1Y2Nlc3NmdWxseSBkZWNvZGVkIGFuZCB0aGUgcmVjZWl2ZSBhcHBsaWNhdGlvbgovLyBsb2dpYyByZXR1cm5zIHdpdGhvdXQgZXJyb3IuCmZ1bmMgKGltIElCQ01vZHVsZSkgT25SZWN2UGFja2V0KAogIGN0eCBzZGsuQ29udGV4dCwKICBwYWNrZXQgY2hhbm5lbHR5cGVzLlBhY2tldCwKICByZWxheWVyIHNkay5BY2NBZGRyZXNzLAopIGliY2V4cG9ydGVkLkFja25vd2xlZGdlbWVudCB7CiAgYWNrIDo9IGNoYW5uZWx0eXBlcy5OZXdSZXN1bHRBY2tub3dsZWRnZW1lbnQoW11ieXRle2J5dGUoMSl9KQoKICB2YXIgZGF0YSB0eXBlcy5GdW5naWJsZVRva2VuUGFja2V0RGF0YQogIGlmIGVyciA6PSB0eXBlcy5Nb2R1bGVDZGMuVW5tYXJzaGFsSlNPTihwYWNrZXQuR2V0RGF0YSgpLCAmYW1wO2RhdGEpOyBlcnIgIT0gbmlsIHsKICAgIGFjayA9IGNoYW5uZWx0eXBlcy5OZXdFcnJvckFja25vd2xlZGdlbWVudCgmcXVvdDtjYW5ub3QgdW5tYXJzaGFsIElDUy0yMCB0cmFuc2ZlciBwYWNrZXQgZGF0YSZxdW90OykKICB9CgogIC8vIG9ubHkgYXR0ZW1wdCB0aGUgYXBwbGljYXRpb24gbG9naWMgaWYgdGhlIHBhY2tldCBkYXRhCiAgLy8gd2FzIHN1Y2Nlc3NmdWxseSBkZWNvZGVkCiAgaWYgYWNrLlN1Y2Nlc3MoKSB7CiAgICBlcnIgOj0gaW0ua2VlcGVyLk9uUmVjdlBhY2tldChjdHgsIHBhY2tldCwgZGF0YSkKICAgIGlmIGVyciAhPSBuaWwgewogICAgICBhY2sgPSB0eXBlcy5OZXdFcnJvckFja25vd2xlZGdlbWVudChlcnIpCiAgICB9CiAgfQoKICBjdHguRXZlbnRNYW5hZ2VyKCkuRW1pdEV2ZW50KAogICAgc2RrLk5ld0V2ZW50KAogICAgICB0eXBlcy5FdmVudFR5cGVQYWNrZXQsCiAgICAgIHNkay5OZXdBdHRyaWJ1dGUoc2RrLkF0dHJpYnV0ZUtleU1vZHVsZSwgdHlwZXMuTW9kdWxlTmFtZSksCiAgICAgIHNkay5OZXdBdHRyaWJ1dGUodHlwZXMuQXR0cmlidXRlS2V5UmVjZWl2ZXIsIGRhdGEuUmVjZWl2ZXIpLAogICAgICBzZGsuTmV3QXR0cmlidXRlKHR5cGVzLkF0dHJpYnV0ZUtleURlbm9tLCBkYXRhLkRlbm9tKSwKICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5BdHRyaWJ1dGVLZXlBbW91bnQsIGRhdGEuQW1vdW50KSwKICAgICAgc2RrLk5ld0F0dHJpYnV0ZSh0eXBlcy5BdHRyaWJ1dGVLZXlBY2tTdWNjZXNzLCBmbXQuU3ByaW50ZigmcXVvdDsldCZxdW90OywgYWNrLlN1Y2Nlc3MoKSkpLAogICAgKSwKICApCgogIC8vIE5PVEU6IGFja25vd2xlZGdtZW50IHdpbGwgYmUgd3JpdHRlbiBzeW5jaHJvbm91c2x5IGR1cmluZyBJQkMgaGFuZGxlciBleGVjdXRpb24uCiAgcmV0dXJuIGFjawp9Cg=="}}),e._v(" "),a("p",[e._v("Take a look at the type "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/proto/ibc/applications/transfer/v2/packet.proto",target:"_blank",rel:"noopener noreferrer"}},[e._v("definition of a token packet"),a("OutboundLink")],1),e._v(" before diving further into the code:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"protobuff",base64:"c3ludGF4ID0gJnF1b3Q7cHJvdG8zJnF1b3Q7OwoKcGFja2FnZSBpYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYyOwoKb3B0aW9uIGdvX3BhY2thZ2UgPSAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9pYmMtZ28vdjMvbW9kdWxlcy9hcHBzL3RyYW5zZmVyL3R5cGVzJnF1b3Q7OwoKLy8gRnVuZ2libGVUb2tlblBhY2tldERhdGEgZGVmaW5lcyBhIHN0cnVjdCBmb3IgdGhlIHBhY2tldCBwYXlsb2FkCi8vIFNlZSBGdW5naWJsZVRva2VuUGFja2V0RGF0YSBzcGVjOgovLyBodHRwczovL2dpdGh1Yi5jb20vY29zbW9zL2liYy90cmVlL21hc3Rlci9zcGVjL2FwcC9pY3MtMDIwLWZ1bmdpYmxlLXRva2VuLXRyYW5zZmVyI2RhdGEtc3RydWN0dXJlcwptZXNzYWdlIEZ1bmdpYmxlVG9rZW5QYWNrZXREYXRhIHsKICAvLyB0aGUgdG9rZW4gZGVub21pbmF0aW9uIHRvIGJlIHRyYW5zZmVycmVkCiAgc3RyaW5nIGRlbm9tID0gMTsKICAvLyB0aGUgdG9rZW4gYW1vdW50IHRvIGJlIHRyYW5zZmVycmVkCiAgc3RyaW5nIGFtb3VudCA9IDI7CiAgLy8gdGhlIHNlbmRlciBhZGRyZXNzCiAgc3RyaW5nIHNlbmRlciA9IDM7CiAgLy8gdGhlIHJlY2lwaWVudCBhZGRyZXNzIG9uIHRoZSBkZXN0aW5hdGlvbiBjaGFpbgogIHN0cmluZyByZWNlaXZlciA9IDQ7Cn0K"}}),e._v(" "),a("p",[e._v("So where does the module send a token? Take a look at the "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/apps/transfer/keeper/msg_server.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("msg_serve.go"),a("OutboundLink")],1),e._v(" of the token transfer module:")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"Ly8gVHJhbnNmZXIgZGVmaW5lcyBhIHJwYyBoYW5kbGVyIG1ldGhvZCBmb3IgTXNnVHJhbnNmZXIuCmZ1bmMgKGsgS2VlcGVyKSBUcmFuc2Zlcihnb0N0eCBjb250ZXh0LkNvbnRleHQsIG1zZyAqdHlwZXMuTXNnVHJhbnNmZXIpICgqdHlwZXMuTXNnVHJhbnNmZXJSZXNwb25zZSwgZXJyb3IpIHsKCiAgLi4uCgogIGlmIGVyciA6PSBrLlNlbmRUcmFuc2ZlcigKICAgIGN0eCwgbXNnLlNvdXJjZVBvcnQsIG1zZy5Tb3VyY2VDaGFubmVsLCBtc2cuVG9rZW4sIHNlbmRlciwgbXNnLlJlY2VpdmVyLCBtc2cuVGltZW91dEhlaWdodCwgbXNnLlRpbWVvdXRUaW1lc3RhbXAsCiAgKTsgZXJyICE9IG5pbCB7CiAgICByZXR1cm4gbmlsLCBlcnIKICB9CiAgLi4uCgp9Cg=="}}),e._v(" "),a("p",[e._v("There you see "),a("code",[e._v("SendTransfer")]),e._v(", which implements the application logic after "),a("a",{attrs:{href:"https://github.com/cosmos/ibc-go/blob/main/modules/apps/transfer/types/coin.go",target:"_blank",rel:"noopener noreferrer"}},[e._v("cheking if the sender is a source or sink chain"),a("OutboundLink")],1),e._v(":")]),e._v(" "),a("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFNlbmRUcmFuc2ZlcigKICBjdHggc2RrLkNvbnRleHQsCiAgc291cmNlUG9ydCwKICBzb3VyY2VDaGFubmVsIHN0cmluZywKICB0b2tlbiBzZGsuQ29pbiwKICBzZW5kZXIgc2RrLkFjY0FkZHJlc3MsCiAgcmVjZWl2ZXIgc3RyaW5nLAogIHRpbWVvdXRIZWlnaHQgY2xpZW50dHlwZXMuSGVpZ2h0LAogIHRpbWVvdXRUaW1lc3RhbXAgdWludDY0LAopIAoKICAuLi4KCiAgLy8gZGVjb25zdHJ1Y3QgdGhlIHRva2VuIGRlbm9taW5hdGlvbiBpbnRvIHRoZSBkZW5vbWluYXRpb24gdHJhY2UgaW5mbwogIC8vIHRvIGRldGVybWluZSBpZiB0aGUgc2VuZGVyIGlzIHRoZSBzb3VyY2UgY2hhaW4KICBpZiBzdHJpbmdzLkhhc1ByZWZpeCh0b2tlbi5EZW5vbSwgJnF1b3Q7aWJjLyZxdW90OykgewogICAgZnVsbERlbm9tUGF0aCwgZXJyID0gay5EZW5vbVBhdGhGcm9tSGFzaChjdHgsIHRva2VuLkRlbm9tKQogICAgaWYgZXJyICE9IG5pbCB7CiAgICAgIHJldHVybiBlcnIKICAgIH0KICB9CgogIC4uLgoKICAvLyBOT1RFOiBTZW5kVHJhbnNmZXIgc2ltcGx5IHNlbmRzIHRoZSBkZW5vbWluYXRpb24gYXMgaXQgZXhpc3RzIG9uIGl0cyBvd24KICAvLyBjaGFpbiBpbnNpZGUgdGhlIHBhY2tldCBkYXRhLiBUaGUgcmVjZWl2aW5nIGNoYWluIHdpbGwgcGVyZm9ybSBkZW5vbQogIC8vIHByZWZpeGluZyBhcyBuZWNlc3NhcnkuCgogIGlmIHR5cGVzLlNlbmRlckNoYWluSXNTb3VyY2Uoc291cmNlUG9ydCwgc291cmNlQ2hhbm5lbCwgZnVsbERlbm9tUGF0aCkgewoKICAgIC4uLgoKICAgIC8vIGNyZWF0ZSB0aGUgZXNjcm93IGFkZHJlc3MgZm9yIHRoZSB0b2tlbnMKICAgIGVzY3Jvd0FkZHJlc3MgOj0gdHlwZXMuR2V0RXNjcm93QWRkcmVzcyhzb3VyY2VQb3J0LCBzb3VyY2VDaGFubmVsKQoKICAgIC8vIGVzY3JvdyBzb3VyY2UgdG9rZW5zLiBJdCBmYWlscyBpZiBiYWxhbmNlIGluc3VmZmljaWVudC4KICAgIGlmIGVyciA6PSBrLmJhbmtLZWVwZXIuU2VuZENvaW5zKC4uLikKCiAgfSBlbHNlIHsKICAgCiAgIC4uLgoKICAgIGlmIGVyciA6PSBrLmJhbmtLZWVwZXIuU2VuZENvaW5zRnJvbUFjY291bnRUb01vZHVsZSguLi4pOyAKCiAgICAuLi4KCiAgICBpZiBlcnIgOj0gay5iYW5rS2VlcGVyLkJ1cm5Db2lucyguLi4pOyAKCiAgICAuLi4KICB9CgogIHBhY2tldERhdGEgOj0gdHlwZXMuTmV3RnVuZ2libGVUb2tlblBhY2tldERhdGEoCiAgICBmdWxsRGVub21QYXRoLCB0b2tlbi5BbW91bnQuU3RyaW5nKCksIHNlbmRlci5TdHJpbmcoKSwgcmVjZWl2ZXIsCiAgKQouLi4KCn0K"}})],1)}),[],!1,null,null,null);n.default=o.exports}}]);